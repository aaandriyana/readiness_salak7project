<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Item Monitoring System v24 - Resource Readiness Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #111820;
            --bg-tertiary: #1a2332;
            --bg-card: #151c28;
            --accent-orange: #ff6b2c;
            --accent-orange-dim: #cc5624;
            --accent-blue: #2d9cdb;
            --accent-green: #27ae60;
            --accent-yellow: #f2c94c;
            --accent-red: #eb5757;
            --accent-purple: #9b51e0;
            --accent-cyan: #00bcd4;
            --text-primary: #e8edf4;
            --text-secondary: #8fa3bf;
            --text-muted: #5a6b82;
            --border-color: #2a3545;
            --border-accent: #3a4a5f;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .bg-pattern {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            opacity: 0.03;
            background-image: 
                linear-gradient(var(--accent-orange) 1px, transparent 1px),
                linear-gradient(90deg, var(--accent-orange) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
        }

        .page { display: none; position: relative; z-index: 1; min-height: 100vh; }
        .page.active { display: block; }
        .container { max-width: 1800px; margin: 0 auto; padding: 20px; }

        .header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap; gap: 15px;
        }

        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon {
            width: 45px; height: 45px;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-orange-dim));
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; box-shadow: 0 4px 15px rgba(255, 107, 44, 0.3);
        }
        .logo-text h1 { font-size: 18px; font-weight: 700; }
        .logo-text span { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 2px; }

        .header-actions { display: flex; gap: 8px; flex-wrap: wrap; }

        .btn {
            padding: 8px 16px; border: none; border-radius: 6px;
            font-family: inherit; font-size: 12px; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center; gap: 5px;
        }
        .btn-primary { background: linear-gradient(135deg, var(--accent-orange), var(--accent-orange-dim)); color: white; }
        .btn-primary:hover { transform: translateY(-1px); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: var(--border-color); }
        .btn-success { background: var(--accent-green); color: white; }
        .btn-back { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-back:hover { background: var(--accent-orange); border-color: var(--accent-orange); }
        .btn-danger { background: var(--accent-red); color: white; }

        .stats-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-card {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 12px; position: relative; overflow: hidden;
        }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px; }
        .stat-card.total::before { background: var(--accent-blue); }
        .stat-card.not-started::before { background: var(--accent-purple); }
        .stat-card.overdue::before { background: var(--accent-red); }
        .stat-card.at-risk::before { background: var(--accent-yellow); }
        .stat-card.completed::before { background: var(--accent-green); }
        .stat-card.pending::before { background: var(--accent-orange); }
        .stat-card.critical::before { background: #ff1744; }
        .stat-card.ready-to-start::before { background: var(--accent-cyan); }

        .stat-icon {
            width: 32px; height: 32px; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; margin-bottom: 8px;
        }
        .stat-card.total .stat-icon { background: rgba(45, 156, 219, 0.15); }
        .stat-card.not-started .stat-icon { background: rgba(155, 81, 224, 0.15); }
        .stat-card.overdue .stat-icon { background: rgba(235, 87, 87, 0.15); }
        .stat-card.at-risk .stat-icon { background: rgba(242, 201, 76, 0.15); }
        .stat-card.completed .stat-icon { background: rgba(39, 174, 96, 0.15); }
        .stat-card.pending .stat-icon { background: rgba(255, 107, 44, 0.15); }
        .stat-card.critical .stat-icon { background: rgba(255, 23, 68, 0.15); }
        .stat-card.ready-to-start .stat-icon { background: rgba(0, 188, 212, 0.15); }

        .stat-value { font-size: 22px; font-weight: 800; font-family: 'JetBrains Mono', monospace; }
        .stat-label { font-size: 9px; color: var(--text-secondary); font-weight: 600; }

        .panel { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; overflow: hidden; }
        .panel-header {
            padding: 12px 15px; border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            flex-wrap: wrap; gap: 10px;
        }
        .panel-title { font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .panel-title span { color: var(--accent-orange); }

        .filter-tabs { display: flex; gap: 4px; flex-wrap: wrap; }
        .filter-tab {
            padding: 4px 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color);
            border-radius: 4px; font-size: 9px; font-weight: 600; color: var(--text-secondary); cursor: pointer;
        }
        .filter-tab.active, .filter-tab:hover { background: var(--accent-orange); border-color: var(--accent-orange); color: white; }

        .search-box {
            display: flex; align-items: center; gap: 8px; padding: 8px 12px;
            background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color);
        }
        .search-box input {
            flex: 1; background: transparent; border: none;
            color: var(--text-primary); font-family: inherit; font-size: 11px; outline: none;
        }

        .table-container { overflow-x: auto; max-height: 500px; overflow-y: auto; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th {
            position: sticky; top: 0; background: var(--bg-tertiary);
            padding: 8px 10px; text-align: left; font-size: 8px; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color); z-index: 10; white-space: nowrap;
        }
        .data-table td {
            padding: 6px 10px; border-bottom: 1px solid var(--border-color);
            font-size: 10px; vertical-align: middle;
        }
        .data-table tr:hover { background: rgba(255, 107, 44, 0.03); }
        .data-table tr.level-1 { background: rgba(45, 156, 219, 0.08); }
        .data-table tr.level-2 { background: rgba(45, 156, 219, 0.05); }
        .data-table tr.level-3 { background: rgba(45, 156, 219, 0.03); }
        .data-table tr.level-4 { background: rgba(255, 107, 44, 0.03); }

        .wbs-code { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--accent-blue); font-weight: 600; }
        .item-name { font-weight: 500; max-width: 250px; line-height: 1.3; font-size: 10px; }
        .item-name.indent-1 { padding-left: 0; font-weight: 700; }
        .item-name.indent-2 { padding-left: 10px; font-weight: 600; }
        .item-name.indent-3 { padding-left: 20px; font-weight: 500; }
        .item-name.indent-4 { padding-left: 30px; }
        .item-name.indent-5 { padding-left: 40px; }

        .item-level {
            display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px; background: var(--bg-tertiary);
            border-radius: 3px; font-size: 8px; font-weight: 700;
        }
        .item-level.level-1 { background: var(--accent-blue); color: white; }
        .item-level.level-2 { background: var(--accent-purple); color: white; }
        .item-level.level-3 { background: var(--accent-cyan); color: white; }
        .item-level.level-4 { background: var(--accent-yellow); color: #333; }
        .item-level.level-5 { background: var(--accent-orange); color: white; }

        .plan-date { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--text-secondary); }

        .status-badge {
            display: inline-flex; align-items: center; gap: 3px;
            padding: 3px 6px; border-radius: 10px; font-size: 8px;
            font-weight: 700; text-transform: uppercase; white-space: nowrap;
        }
        .status-badge.not-started { background: rgba(155, 81, 224, 0.15); color: var(--accent-purple); }
        .status-badge.overdue { background: rgba(235, 87, 87, 0.2); color: var(--accent-red); }
        .status-badge.at-risk { background: rgba(242, 201, 76, 0.2); color: var(--accent-yellow); }
        .status-badge.completed { background: rgba(39, 174, 96, 0.15); color: var(--accent-green); }
        .status-badge.in-progress { background: rgba(45, 156, 219, 0.15); color: var(--accent-blue); }
        .status-badge.ready-to-start { background: rgba(39, 174, 96, 0.25); color: var(--accent-green); }
        .status-badge.partially-ready { background: rgba(0, 188, 212, 0.2); color: var(--accent-cyan); }
        .status-badge.resources-lacking { background: rgba(255, 107, 44, 0.2); color: var(--accent-orange); }
        .status-badge.unknown { background: rgba(143, 163, 191, 0.15); color: var(--text-secondary); }

        .resource-score { display: flex; align-items: center; gap: 6px; }
        .score-bar { width: 50px; height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; }
        .score-fill { height: 100%; border-radius: 3px; transition: width 0.3s ease; }
        .score-fill.low { background: var(--accent-red); }
        .score-fill.medium { background: var(--accent-yellow); }
        .score-fill.high { background: var(--accent-green); }
        .score-text { font-family: 'JetBrains Mono', monospace; font-size: 9px; font-weight: 700; }

        .risk-badge { padding: 3px 8px; border-radius: 10px; font-size: 8px; font-weight: 700; text-transform: uppercase; }
        .risk-badge.critical { background: rgba(255, 23, 68, 0.2); color: #ff1744; }
        .risk-badge.high { background: rgba(235, 87, 87, 0.2); color: var(--accent-red); }
        .risk-badge.medium { background: rgba(242, 201, 76, 0.2); color: var(--accent-yellow); }
        .risk-badge.low { background: rgba(39, 174, 96, 0.2); color: var(--accent-green); }

        .action-btn {
            padding: 4px 8px; background: var(--bg-tertiary); border: 1px solid var(--border-color);
            border-radius: 4px; font-size: 8px; font-weight: 600; color: var(--text-primary); cursor: pointer;
        }
        .action-btn:hover { background: var(--accent-orange); border-color: var(--accent-orange); }
        .action-btn.checked { background: var(--accent-green); border-color: var(--accent-green); }
        .action-btn.auto { background: var(--accent-blue); border-color: var(--accent-blue); cursor: default; opacity: 0.7; }
        .action-btn.completed-auto { background: var(--accent-green); border-color: var(--accent-green); cursor: default; opacity: 0.8; }
        .action-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        .item-count { font-size: 10px; color: var(--text-secondary); padding: 6px 12px; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); }
        .item-count strong { color: var(--accent-orange); }

        .empty-state { text-align: center; padding: 30px 15px; color: var(--text-secondary); }
        .empty-state-icon { font-size: 35px; opacity: 0.3; margin-bottom: 10px; }
        .empty-state h3 { font-size: 13px; color: var(--text-primary); margin-bottom: 5px; }

        .upload-zone {
            border: 2px dashed var(--border-accent); border-radius: 10px;
            padding: 25px 15px; text-align: center; cursor: pointer;
            margin-bottom: 15px; background: rgba(255, 107, 44, 0.02);
        }
        .upload-zone:hover, .upload-zone.dragover { border-color: var(--accent-orange); background: rgba(255, 107, 44, 0.05); }
        .upload-icon { font-size: 35px; margin-bottom: 10px; opacity: 0.7; }
        .upload-zone h3 { font-size: 14px; margin-bottom: 4px; }
        .upload-zone p { font-size: 10px; color: var(--text-secondary); }
        .upload-zone .note { font-size: 9px; color: var(--accent-green); margin-top: 8px; font-weight: 600; }

        #fileInput { display: none; }
        .progress-container { margin-top: 12px; display: none; }
        .progress-container.show { display: block; }
        .progress-bar { height: 4px; background: var(--bg-tertiary); border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-orange), var(--accent-yellow)); width: 0%; transition: width 0.3s; }
        .progress-text { font-size: 9px; color: var(--text-secondary); margin-top: 5px; text-align: center; }

        .import-result { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px 15px; margin-bottom: 15px; display: none; }
        .import-result.show { display: block; }
        .import-result h4 { font-size: 12px; margin-bottom: 8px; color: var(--accent-green); }
        .import-result .stats { display: flex; gap: 20px; flex-wrap: wrap; }
        .import-result .stat-item { font-size: 11px; }
        .import-result .stat-item strong { color: var(--accent-orange); }

        .resource-page-header { background: var(--bg-card); border-bottom: 1px solid var(--border-color); padding: 15px 0; margin-bottom: 20px; }
        .resource-page-header .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; padding-top: 0; padding-bottom: 0; }

        .item-info-section { display: grid; grid-template-columns: 1fr 300px; gap: 20px; margin-bottom: 20px; }

        .selected-item-card {
            background: var(--bg-tertiary); border: 1px solid var(--border-color);
            border-radius: 10px; padding: 20px;
            border-left: 4px solid var(--accent-orange);
        }
        
        .item-header-row {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 15px; flex-wrap: wrap; gap: 10px;
        }

        .selected-item-card h3 { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
        .selected-item-card .wbs { font-family: 'JetBrains Mono', monospace; font-size: 20px; color: var(--accent-blue); font-weight: 700; margin-bottom: 4px; }
        .selected-item-card .description { font-size: 15px; font-weight: 600; line-height: 1.4; margin-bottom: 15px; }
        
        .item-hierarchy {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
            margin-bottom: 15px; padding: 15px; background: var(--bg-card);
            border-radius: 8px; border: 1px solid var(--border-color);
        }

        .hierarchy-item { display: flex; flex-direction: column; gap: 4px; }
        .hierarchy-item .label {
            font-size: 9px; color: var(--text-muted); text-transform: uppercase;
            letter-spacing: 1px; display: flex; align-items: center; gap: 6px;
        }
        .hierarchy-item .label .level-badge {
            display: inline-flex; align-items: center; justify-content: center;
            width: 16px; height: 16px; border-radius: 3px; font-size: 8px; font-weight: 700;
        }
        .hierarchy-item .label .level-badge.l1 { background: var(--accent-blue); color: white; }
        .hierarchy-item .label .level-badge.l2 { background: var(--accent-purple); color: white; }
        .hierarchy-item .value { font-size: 12px; font-weight: 600; color: var(--text-primary); line-height: 1.3; }
        .hierarchy-item .value .wbs-small { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--accent-cyan); margin-right: 6px; }

        .selected-item-card .meta { display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .selected-item-card .meta-item { font-size: 11px; color: var(--text-secondary); }
        .selected-item-card .meta-item strong { color: var(--text-primary); }

        .radar-chart-card {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: 10px; padding: 15px; display: flex; flex-direction: column;
        }
        .radar-chart-card h4 { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; text-align: center; }
        .radar-chart-container { flex: 1; display: flex; align-items: center; justify-content: center; min-height: 220px; }

        .resource-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .resource-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; overflow: hidden; }
        .resource-card-header { padding: 12px 15px; background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .resource-card-title { display: flex; align-items: center; gap: 10px; }
        .resource-icon { width: 34px; height: 34px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .resource-icon.engineering { background: rgba(45, 156, 219, 0.2); }
        .resource-icon.material { background: rgba(242, 201, 76, 0.2); }
        .resource-icon.workforce { background: rgba(155, 81, 224, 0.2); }
        .resource-icon.workfront { background: rgba(39, 174, 96, 0.2); }
        .resource-icon.equipment { background: rgba(235, 87, 87, 0.2); }
        .resource-icon.tools { background: rgba(255, 107, 44, 0.2); }
        .resource-card-title h4 { font-size: 12px; font-weight: 700; }
        .resource-status-badge { padding: 4px 10px; border-radius: 12px; font-size: 9px; font-weight: 700; text-transform: uppercase; }
        .resource-status-badge.ready { background: rgba(39, 174, 96, 0.2); color: var(--accent-green); }
        .resource-status-badge.pending { background: rgba(242, 201, 76, 0.2); color: var(--accent-yellow); }
        .resource-status-badge.not-ready { background: rgba(235, 87, 87, 0.2); color: var(--accent-red); }
        .resource-card-body { padding: 15px; }

        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-secondary); margin-bottom: 5px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 8px 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 5px; font-family: inherit; font-size: 11px; color: var(--text-primary); }
        .form-group textarea { min-height: 70px; resize: vertical; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--accent-orange); }

        .score-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; margin-top: 20px; }
        .score-card h3 { font-size: 13px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .score-display { display: flex; gap: 30px; flex-wrap: wrap; align-items: center; }
        .score-circle { width: 100px; height: 100px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid; }
        .score-circle.low { border-color: var(--accent-red); }
        .score-circle.medium { border-color: var(--accent-yellow); }
        .score-circle.high { border-color: var(--accent-green); }
        .score-circle .value { font-size: 28px; font-weight: 800; font-family: 'JetBrains Mono', monospace; }
        .score-circle .label { font-size: 10px; color: var(--text-secondary); }
        .score-details { flex: 1; }
        .score-details .risk-indicator { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .score-details .risk-indicator .risk-badge { font-size: 11px; padding: 5px 12px; }
        .score-details .factors { font-size: 11px; color: var(--text-secondary); line-height: 1.6; white-space: pre-line; }
        
        /* Status Preview */
        .status-preview {
            margin-top: 15px;
            padding: 12px 15px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .status-preview h4 {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .status-preview .preview-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-preview .arrow {
            color: var(--text-muted);
            font-size: 14px;
        }

        .page-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color); }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; width: 95%; max-width: 1200px; max-height: 90vh; overflow: hidden; }
        .modal-header { padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 15px; }
        .modal-close { width: 30px; height: 30px; border-radius: 5px; background: var(--bg-tertiary); border: 1px solid var(--border-color); font-size: 14px; color: var(--text-secondary); cursor: pointer; }
        .modal-close:hover { background: var(--accent-red); color: white; }
        .modal-body { padding: 20px; overflow-y: auto; max-height: calc(90vh - 80px); }
        .summary-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 15px; }
        .summary-card { background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center; }
        .summary-card .value { font-size: 20px; font-weight: 800; font-family: 'JetBrains Mono', monospace; color: var(--accent-orange); }
        .summary-card .label { font-size: 8px; color: var(--text-secondary); text-transform: uppercase; margin-top: 3px; }
        .resource-summary-table { width: 100%; border-collapse: collapse; font-size: 9px; }
        .resource-summary-table th, .resource-summary-table td { padding: 6px 8px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .resource-summary-table th { background: var(--bg-tertiary); font-size: 8px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); }

        .toast { position: fixed; bottom: 20px; right: 20px; padding: 10px 15px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 6px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4); display: flex; align-items: center; gap: 8px; transform: translateY(100px); opacity: 0; transition: all 0.3s ease; z-index: 2000; font-size: 11px; }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { border-left: 3px solid var(--accent-green); }
        .toast.error { border-left: 3px solid var(--accent-red); }
        .toast.info { border-left: 3px solid var(--accent-blue); }

        @media (max-width: 1400px) { .stats-grid { grid-template-columns: repeat(4, 1fr); } .resource-grid { grid-template-columns: repeat(2, 1fr); } .item-info-section { grid-template-columns: 1fr; } }
        @media (max-width: 900px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .summary-grid { grid-template-columns: repeat(3, 1fr); } .item-hierarchy { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .resource-grid { grid-template-columns: 1fr; } .header { flex-direction: column; } }
        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .dashboard-stat {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        .dashboard-stat::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 4px;
        }
        .dashboard-stat.blue::before { background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan)); }
        .dashboard-stat.green::before { background: linear-gradient(90deg, var(--accent-green), #2ecc71); }
        .dashboard-stat.orange::before { background: linear-gradient(90deg, var(--accent-orange), var(--accent-yellow)); }
        .dashboard-stat.red::before { background: linear-gradient(90deg, var(--accent-red), #ff1744); }
        .dashboard-stat .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        .dashboard-stat .stat-icon-large {
            width: 50px; height: 50px;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px;
        }
        .dashboard-stat.blue .stat-icon-large { background: rgba(45, 156, 219, 0.15); }
        .dashboard-stat.green .stat-icon-large { background: rgba(39, 174, 96, 0.15); }
        .dashboard-stat.orange .stat-icon-large { background: rgba(255, 107, 44, 0.15); }
        .dashboard-stat.red .stat-icon-large { background: rgba(235, 87, 87, 0.15); }
        .dashboard-stat .stat-value-large {
            font-size: 36px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1;
        }
        .dashboard-stat .stat-label-large {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .dashboard-stat .stat-change {
            font-size: 10px;
            margin-top: 8px;
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
        }
        .dashboard-stat .stat-change.positive { background: rgba(39, 174, 96, 0.15); color: var(--accent-green); }
        .dashboard-stat .stat-change.negative { background: rgba(235, 87, 87, 0.15); color: var(--accent-red); }
        .dashboard-stat .stat-change.neutral { background: rgba(143, 163, 191, 0.15); color: var(--text-secondary); }

        .dashboard-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .dashboard-row.three-cols {
            grid-template-columns: 1fr 1fr 1fr;
        }
        .chart-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }
        .chart-panel h3 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-panel h3 span { color: var(--accent-orange); }
        .chart-container {
            position: relative;
            height: 280px;
        }
        .chart-container.small {
            height: 220px;
        }

        .critical-list-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }
        .critical-list-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(235, 87, 87, 0.1), rgba(255, 23, 68, 0.1));
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .critical-list-header h3 {
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-red);
        }
        .critical-count {
            background: var(--accent-red);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 700;
        }
        .critical-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .critical-item {
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: 80px 1fr 100px 80px 80px;
            gap: 15px;
            align-items: center;
            transition: background 0.2s;
        }
        .critical-item:hover {
            background: rgba(235, 87, 87, 0.05);
        }
        .critical-item:last-child {
            border-bottom: none;
        }
        .critical-item .wbs {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--accent-blue);
            font-weight: 600;
        }
        .critical-item .desc {
            font-size: 11px;
            font-weight: 500;
            line-height: 1.3;
        }
        .critical-item .area-disc {
            font-size: 9px;
            color: var(--text-muted);
        }
        .critical-item .date {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--accent-red);
        }
        .critical-item .days-badge {
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 10px;
            background: rgba(255, 23, 68, 0.2);
            color: #ff1744;
            font-weight: 700;
            text-align: center;
        }

        .progress-ring {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 20px;
        }
        .ring-item {
            text-align: center;
        }
        .ring-item .ring-value {
            font-size: 24px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        .ring-item .ring-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .area-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .area-item {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .area-item .area-name {
            font-size: 11px;
            font-weight: 600;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .area-item .area-stats {
            display: flex;
            gap: 8px;
        }
        .area-item .area-stat {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        .area-item .area-stat.total { background: rgba(45, 156, 219, 0.15); color: var(--accent-blue); }
        .area-item .area-stat.ready { background: rgba(39, 174, 96, 0.15); color: var(--accent-green); }
        .area-item .area-stat.critical { background: rgba(235, 87, 87, 0.15); color: var(--accent-red); }

        .area-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
            padding: 12px 15px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            min-width: 28px;
            height: 20px;
            border-radius: 4px;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            padding: 0 6px;
        }
        .legend-color.total { background: rgba(45, 156, 219, 0.15); color: var(--accent-blue); }
        .legend-color.total::after { content: '5'; }
        .legend-color.ready { background: rgba(39, 174, 96, 0.15); color: var(--accent-green); }
        .legend-color.ready::after { content: '3 âœ“'; }
        .legend-color.critical { background: rgba(235, 87, 87, 0.15); color: var(--accent-red); }
        .legend-color.critical::after { content: '1 !'; }
        .legend-text {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: var(--bg-card);
            padding: 5px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            width: fit-content;
        }
        .nav-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: 6px;
            font-family: inherit;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .nav-tab:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }
        .nav-tab.active {
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-orange-dim));
            color: white;
        }

        .top-rank-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .top-rank-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(255, 107, 44, 0.1), rgba(242, 201, 76, 0.1));
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .top-rank-header h3 {
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-orange);
        }
        .top-rank-list {
            padding: 10px 0;
        }
        .top-rank-item {
            padding: 12px 20px;
            display: grid;
            grid-template-columns: 40px 80px 1fr 100px 80px 80px 90px;
            gap: 12px;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
        }
        .top-rank-item:hover {
            background: rgba(255, 107, 44, 0.05);
        }
        .top-rank-item:last-child {
            border-bottom: none;
        }
        .rank-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        .rank-number.gold { background: linear-gradient(135deg, #ffd700, #ffb700); color: #333; }
        .rank-number.silver { background: linear-gradient(135deg, #c0c0c0, #a8a8a8); color: #333; }
        .rank-number.bronze { background: linear-gradient(135deg, #cd7f32, #b87333); color: white; }
        .rank-number.normal { background: var(--bg-tertiary); color: var(--text-secondary); }
        .top-rank-item .wbs {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--accent-blue);
            font-weight: 600;
        }
        .top-rank-item .desc {
            font-size: 11px;
            font-weight: 500;
            line-height: 1.3;
        }
        .top-rank-item .area-disc {
            font-size: 9px;
            color: var(--text-muted);
            margin-top: 2px;
        }
        .top-rank-item .date {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--accent-red);
        }
        .top-rank-item .score-mini {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 700;
        }
        .top-rank-item .days-left {
            font-size: 9px;
            padding: 4px 8px;
            border-radius: 10px;
            font-weight: 700;
            text-align: center;
        }
        .top-rank-item .days-left.overdue { background: rgba(255, 23, 68, 0.2); color: #ff1744; }
        .top-rank-item .days-left.urgent { background: rgba(235, 87, 87, 0.2); color: var(--accent-red); }
        .top-rank-item .days-left.warning { background: rgba(242, 201, 76, 0.2); color: var(--accent-yellow); }

        .empty-dashboard {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        .empty-dashboard .empty-icon {
            font-size: 60px;
            opacity: 0.3;
            margin-bottom: 20px;
        }
        .empty-dashboard h3 {
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        .empty-dashboard p {
            font-size: 13px;
        }

        /* Risk Analysis Styles */
        .risk-summary-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .risk-summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .risk-summary-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 4px;
        }
        .risk-summary-card.critical::before { background: linear-gradient(90deg, #ff1744, #d50000); }
        .risk-summary-card.high::before { background: linear-gradient(90deg, #eb5757, #c0392b); }
        .risk-summary-card.medium::before { background: linear-gradient(90deg, #f2c94c, #f39c12); }
        .risk-summary-card.low::before { background: linear-gradient(90deg, #27ae60, #2ecc71); }
        .risk-summary-card.total::before { background: linear-gradient(90deg, #2d9cdb, #00bcd4); }
        .risk-summary-card .risk-icon {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .risk-summary-card .risk-value {
            font-size: 32px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        .risk-summary-card .risk-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .risk-summary-card .risk-percent {
            font-size: 12px;
            margin-top: 8px;
            padding: 3px 10px;
            border-radius: 10px;
            display: inline-block;
        }
        .risk-summary-card.critical .risk-percent { background: rgba(255, 23, 68, 0.15); color: #ff1744; }
        .risk-summary-card.high .risk-percent { background: rgba(235, 87, 87, 0.15); color: var(--accent-red); }
        .risk-summary-card.medium .risk-percent { background: rgba(242, 201, 76, 0.15); color: var(--accent-yellow); }
        .risk-summary-card.low .risk-percent { background: rgba(39, 174, 96, 0.15); color: var(--accent-green); }
        .risk-summary-card.total .risk-percent { background: rgba(45, 156, 219, 0.15); color: var(--accent-blue); }

        .risk-matrix {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .risk-matrix h3 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .risk-matrix h3 span { color: var(--accent-orange); }
        .matrix-container {
            display: grid;
            grid-template-columns: 40px repeat(5, 1fr);
            grid-template-rows: repeat(5, 60px) 40px;
            gap: 4px;
        }
        .matrix-label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 700;
            color: var(--text-secondary);
        }
        .matrix-label.y-axis {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
        }
        .matrix-cell {
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .matrix-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .matrix-cell .cell-count {
            font-family: 'JetBrains Mono', monospace;
        }
        .matrix-cell .cell-label {
            font-size: 7px;
            margin-top: 2px;
            opacity: 0.8;
        }
        .matrix-cell.critical { background: rgba(255, 23, 68, 0.8); color: white; }
        .matrix-cell.high { background: rgba(235, 87, 87, 0.8); color: white; }
        .matrix-cell.medium { background: rgba(242, 201, 76, 0.8); color: #333; }
        .matrix-cell.low { background: rgba(39, 174, 96, 0.8); color: white; }
        .matrix-cell.very-low { background: rgba(39, 174, 96, 0.5); color: white; }

        .risk-register-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .risk-register-header {
            padding: 15px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .risk-register-header h3 {
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .risk-filter-tabs {
            display: flex;
            gap: 5px;
        }
        .risk-filter-tab {
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .risk-filter-tab:hover, .risk-filter-tab.active {
            background: var(--accent-orange);
            border-color: var(--accent-orange);
            color: white;
        }
        .risk-register-table {
            width: 100%;
            border-collapse: collapse;
        }
        .risk-register-table th {
            position: sticky;
            top: 0;
            background: var(--bg-tertiary);
            padding: 12px 15px;
            text-align: left;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }
        .risk-register-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            font-size: 11px;
            vertical-align: middle;
        }
        .risk-register-table tr:hover {
            background: rgba(255, 107, 44, 0.03);
        }
        .risk-register-table .risk-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--accent-cyan);
            font-weight: 600;
        }
        .risk-register-table .risk-desc {
            max-width: 250px;
            line-height: 1.4;
        }
        .risk-register-table .risk-factors {
            font-size: 10px;
            color: var(--text-muted);
            max-width: 200px;
        }
        .risk-score-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .risk-score-bar {
            width: 60px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }
        .risk-score-fill {
            height: 100%;
            border-radius: 3px;
        }
        .risk-score-fill.critical { background: #ff1744; }
        .risk-score-fill.high { background: var(--accent-red); }
        .risk-score-fill.medium { background: var(--accent-yellow); }
        .risk-score-fill.low { background: var(--accent-green); }

        .mitigation-badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 600;
        }
        .mitigation-badge.pending { background: rgba(242, 201, 76, 0.2); color: var(--accent-yellow); }
        .mitigation-badge.in-progress { background: rgba(45, 156, 219, 0.2); color: var(--accent-blue); }
        .mitigation-badge.completed { background: rgba(39, 174, 96, 0.2); color: var(--accent-green); }

        .risk-trend-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .risk-heatmap {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }
        .risk-heatmap h3 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .heatmap-grid {
            display: grid;
            grid-template-columns: 100px repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
        }
        .heatmap-header {
            font-size: 9px;
            font-weight: 700;
            color: var(--text-secondary);
            text-align: center;
            padding: 8px;
        }
        .heatmap-row-label {
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            padding-right: 10px;
        }
        .heatmap-cell {
            padding: 10px 8px;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .heatmap-cell.heat-0 { background: rgba(39, 174, 96, 0.2); color: var(--accent-green); }
        .heatmap-cell.heat-1 { background: rgba(39, 174, 96, 0.5); color: white; }
        .heatmap-cell.heat-2 { background: rgba(242, 201, 76, 0.6); color: #333; }
        .heatmap-cell.heat-3 { background: rgba(235, 87, 87, 0.7); color: white; }
        .heatmap-cell.heat-4 { background: rgba(255, 23, 68, 0.9); color: white; }

        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    
    <div class="page active" id="mainPage">
        <div class="container">
            <header class="header">
                <div class="logo">
                    <div class="logo-icon">ðŸ“Š</div>
                    <div class="logo-text">
                        <h1>Work Item Monitor</h1>
                        <span>Resource Readiness Tracker v11</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="goToDashboard()">ðŸ“Š Dashboard</button>
                    <button class="btn btn-primary" onclick="goToRiskAnalysis()" style="background: linear-gradient(135deg, #eb5757, #c0392b);">âš ï¸ Risk Analysis</button>
                    <button class="btn btn-danger" onclick="clearData()">ðŸ—‘ï¸ Clear All</button>
                    <button class="btn btn-secondary" onclick="exportData()">ðŸ“¥ Export</button>
                    <button class="btn btn-secondary" onclick="showSummaryModal()">ðŸ“‹ Summary</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">ðŸ“„ Import PDF</button>
                </div>
            </header>

            <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">ðŸ“</div>
                <h3>Drop PDF file atau klik untuk upload</h3>
                <p>Format: PDF Schedule dengan kolom Lvl, WBS, Description, RE-BASELINE Start, Status</p>
                <div class="note">âœ… Status Lvl 5 auto-update berdasarkan Resource Readiness | Data tersimpan saat upload PDF baru</div>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <div class="progress-text" id="progressText">Memproses...</div>
                </div>
            </div>
            <input type="file" id="fileInput" accept=".pdf" onchange="handleFileUpload(event)">

            <div class="import-result" id="importResult">
                <h4>ðŸ“Š Hasil Import Terakhir</h4>
                <div class="stats">
                    <div class="stat-item">Total Item: <strong id="resultTotal">0</strong></div>
                    <div class="stat-item">Item Baru: <strong id="resultNew">0</strong></div>
                    <div class="stat-item">Item Update: <strong id="resultUpdated">0</strong></div>
                    <div class="stat-item">Resource Preserved: <strong id="resultPreserved">0</strong></div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card total"><div class="stat-icon">ðŸ“¦</div><div class="stat-value" id="totalItems">0</div><div class="stat-label">Total Item</div></div>
                <div class="stat-card not-started"><div class="stat-icon">ðŸ•“</div><div class="stat-value" id="notStartedItems">0</div><div class="stat-label">Not Started</div></div>
                <div class="stat-card overdue"><div class="stat-icon">ðŸ”´</div><div class="stat-value" id="overdueItems">0</div><div class="stat-label">Overdue</div></div>
                <div class="stat-card completed"><div class="stat-icon">âœ…</div><div class="stat-value" id="completedItems">0</div><div class="stat-label">Completed</div></div>
                <div class="stat-card ready-to-start"><div class="stat-icon">ðŸš€</div><div class="stat-value" id="readyToStartItems">0</div><div class="stat-label">Ready to Start</div></div>
                <div class="stat-card pending"><div class="stat-icon">â³</div><div class="stat-value" id="pendingResource">0</div><div class="stat-label">Need Check</div></div>
                <div class="stat-card at-risk"><div class="stat-icon">âš ï¸</div><div class="stat-value" id="highRiskItems">0</div><div class="stat-label">High Risk</div></div>
                <div class="stat-card critical"><div class="stat-icon">ðŸš¨</div><div class="stat-value" id="criticalItems">0</div><div class="stat-label">Critical</div></div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">ðŸ“‹ <span>Daftar Item Pekerjaan</span></h2>
                    <div class="filter-tabs">
                        <button class="filter-tab active" onclick="filterItems('all', this)">Semua</button>
                        <button class="filter-tab" onclick="filterItems('level5-all', this)">All Lvl 5</button>
                        <button class="filter-tab" onclick="filterItems('level5-pending', this)">Lvl 5 Pending</button>
                        <button class="filter-tab" onclick="filterItems('ready-to-start', this)">Ready to Start</button>
                        <button class="filter-tab" onclick="filterItems('critical', this)">Critical</button>
                        <button class="filter-tab" onclick="filterItems('completed', this)">Completed</button>
                    </div>
                </div>
                <div class="search-box">
                    <span>ðŸ”</span>
                    <input type="text" id="searchInput" placeholder="Cari WBS atau Description..." oninput="searchItems()">
                </div>
                <div class="item-count" id="itemCount">Menampilkan <strong>0</strong> item</div>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>Lvl</th><th>WBS</th><th>Description</th><th>Plan Start</th><th>Status</th><th>Score</th><th>Risk Level</th><th>Aksi</th></tr></thead>
                        <tbody id="workItemsBody"><tr><td colspan="8"><div class="empty-state"><div class="empty-state-icon">ðŸ“„</div><h3>Belum Ada Data</h3><p>Import file PDF untuk memulai</p></div></td></tr></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div class="page" id="dashboardPage">
        <div class="container">
            <header class="header">
                <div class="logo">
                    <div class="logo-icon">ðŸ“Š</div>
                    <div class="logo-text">
                        <h1>Dashboard Analytics</h1>
                        <span>Work Item Monitoring Overview</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-back" onclick="goBackFromDashboard()">â† Kembali ke Monitor</button>
                    <button class="btn btn-primary" onclick="exportDashboardPDF()">ðŸ“„ Export PDF</button>
                    <button class="btn btn-secondary" onclick="refreshDashboard()">ðŸ”„ Refresh</button>
                </div>
            </header>

            <div id="dashboardContent">
                <!-- Dashboard content will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Risk Analysis Page -->
    <div class="page" id="riskAnalysisPage">
        <div class="container">
            <header class="header">
                <div class="logo">
                    <div class="logo-icon" style="background: linear-gradient(135deg, #eb5757, #c0392b);">âš ï¸</div>
                    <div class="logo-text">
                        <h1>Risk Analysis</h1>
                        <span>Risk Register & Trend Analysis</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-back" onclick="goBackFromRiskAnalysis()">â† Kembali ke Monitor</button>
                    <button class="btn btn-primary" onclick="exportRiskAnalysisPDF()">ðŸ“„ Export PDF</button>
                    <button class="btn btn-secondary" onclick="exportRiskRegister()">ðŸ“¥ Export CSV</button>
                    <button class="btn btn-secondary" onclick="refreshRiskAnalysis()">ðŸ”„ Refresh</button>
                </div>
            </header>

            <div id="riskAnalysisContent">
                <!-- Risk Analysis content will be rendered here -->
            </div>
        </div>
    </div>

    <div class="page" id="resourcePage">
        <div class="resource-page-header">
            <div class="container">
                <div class="logo">
                    <div class="logo-icon">ðŸ”§</div>
                    <div class="logo-text"><h1>Resource Readiness Input</h1><span>Cek Kesiapan Resource</span></div>
                </div>
                <button class="btn btn-back" onclick="goBackToMain()">â† Kembali ke Daftar</button>
            </div>
        </div>
        <div class="container">
            <div class="item-info-section">
                <div class="selected-item-card">
                    <div class="item-header-row">
                        <div>
                            <h3>Item Pekerjaan Terpilih</h3>
                            <div class="wbs" id="resourceWBS">-</div>
                        </div>
                        <div class="meta">
                            <div class="meta-item">Plan Start: <strong id="resourcePlanStart">-</strong></div>
                            <div class="meta-item">Status Awal: <span class="status-badge" id="resourceStatus">-</span></div>
                        </div>
                    </div>
                    <div class="description" id="resourceDescription">-</div>
                    
                    <div class="item-hierarchy">
                        <div class="hierarchy-item">
                            <div class="label"><span class="level-badge l1">1</span> Area</div>
                            <div class="value" id="resourceArea">-</div>
                        </div>
                        <div class="hierarchy-item">
                            <div class="label"><span class="level-badge l2">2</span> Discipline</div>
                            <div class="value" id="resourceDiscipline">-</div>
                        </div>
                    </div>
                    
                    <!-- Status Preview after save -->
                    <div class="status-preview">
                        <h4>ðŸ“Š Preview Status Setelah Simpan</h4>
                        <div class="preview-row">
                            <span class="status-badge" id="previewOldStatus">-</span>
                            <span class="arrow">â†’</span>
                            <span class="status-badge" id="previewNewStatus">-</span>
                        </div>
                    </div>
                </div>

                <div class="radar-chart-card">
                    <h4>ðŸ“Š Resource Readiness Chart</h4>
                    <div class="radar-chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="resource-grid" id="resourceGrid"></div>

            <div class="score-card">
                <h3>ðŸ“Š Resource Readiness Score & Risk Level</h3>
                <div class="score-display">
                    <div class="score-circle" id="scoreCircle"><span class="value" id="scoreValue">0%</span><span class="label">Score</span></div>
                    <div class="score-details">
                        <div class="risk-indicator"><span>Risk Level:</span><span class="risk-badge" id="riskBadge">-</span></div>
                        <div class="factors" id="riskFactors">Faktor risiko akan dihitung berdasarkan kesiapan resource dan proximity ke plan start date.</div>
                    </div>
                </div>
            </div>

            <div class="page-actions">
                <button class="btn btn-secondary" onclick="goBackToMain()">â† Kembali</button>
                <button class="btn btn-success" onclick="saveAllResources()">ðŸ’¾ Simpan Semua & Kembali</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="summaryModal">
        <div class="modal">
            <div class="modal-header">
                <h2>ðŸ“Š Ringkasan Resource Readiness - Level 5 Items</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-primary" onclick="exportSummaryPDF()" style="padding: 6px 12px; font-size: 11px;">ðŸ“„ Export PDF</button>
                    <button class="modal-close" onclick="closeSummaryModal()">Ã—</button>
                </div>
            </div>
            <div class="modal-body" id="summaryModalBody">
                <div class="summary-grid">
                    <div class="summary-card"><div class="value" id="summaryTotal">0</div><div class="label">Total Lvl 5</div></div>
                    <div class="summary-card"><div class="value" id="summaryCompleted">0</div><div class="label">Completed</div></div>
                    <div class="summary-card"><div class="value" id="summaryReady">0</div><div class="label">Ready to Start</div></div>
                    <div class="summary-card"><div class="value" id="summaryCritical">0</div><div class="label">Critical</div></div>
                    <div class="summary-card"><div class="value" id="summaryHighRisk">0</div><div class="label">High Risk</div></div>
                </div>
                <h3 style="margin-bottom: 10px; font-size: 12px;">Detail Semua Item Level 5</h3>
                <div style="overflow-x: auto;">
                    <table class="resource-summary-table">
                        <thead><tr><th>WBS</th><th>Description</th><th>Area</th><th>Discipline</th><th>Plan Start</th><th>Status</th><th>Score</th><th>Risk</th><th>Eng</th><th>Mat</th><th>WF</th><th>Front</th><th>Equip</th><th>Tools</th></tr></thead>
                        <tbody id="summaryTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"><span id="toastMessage"></span></div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let workItems = [];
        let filteredItems = [];
        let selectedItemId = null;
        let currentFilter = 'all';
        let searchQuery = '';
        let radarChart = null;

        const resourceTypes = ['engineering', 'material', 'workforce', 'workfront', 'equipment', 'tools'];
        const resourceLabels = {
            engineering: { icon: 'ðŸ—ï¸', name: 'Engineering', desc: 'Kesiapan desain, drawing, dan engineering support' },
            material: { icon: 'ðŸ“¦', name: 'Material', desc: 'Ketersediaan material dan bahan konstruksi' },
            workforce: { icon: 'ðŸ‘·', name: 'Work Force', desc: 'Tenaga kerja dan SDM yang dibutuhkan' },
            workfront: { icon: 'ðŸŽ¯', name: 'Workfront', desc: 'Area kerja dan akses lokasi' },
            equipment: { icon: 'ðŸšœ', name: 'Construction Equipment', desc: 'Alat berat dan equipment konstruksi' },
            tools: { icon: 'ðŸ”¨', name: 'Tools', desc: 'Peralatan kerja dan tools pendukung' }
        };

        // Helper function to parse date strings with various formats
        function parseDateString(dateStr) {
            if (!dateStr) return null;
            
            // Try ISO format first (YYYY-MM-DD)
            if (dateStr.includes('-')) {
                const parts = dateStr.split('-');
                if (parts.length >= 3 && parts[0].length === 4) {
                    return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                }
            }
            
            // Try DD/MM/YYYY format
            if (dateStr.includes('/')) {
                const parts = dateStr.split('/');
                if (parts.length >= 3) {
                    let day, month, year;
                    if (parts[2].length === 4) {
                        // DD/MM/YYYY
                        day = parseInt(parts[0]);
                        month = parseInt(parts[1]) - 1;
                        year = parseInt(parts[2]);
                    } else if (parts[0].length === 4) {
                        // YYYY/MM/DD
                        year = parseInt(parts[0]);
                        month = parseInt(parts[1]) - 1;
                        day = parseInt(parts[2]);
                    } else {
                        // Assume DD/MM/YY
                        day = parseInt(parts[0]);
                        month = parseInt(parts[1]) - 1;
                        year = parseInt(parts[2]) + 2000;
                    }
                    return new Date(year, month, day);
                }
            }
            
            // Fallback to native Date parsing
            const parsed = new Date(dateStr);
            return isNaN(parsed.getTime()) ? null : parsed;
        }

        // Helper function to get month key from date string
        function getMonthKey(dateStr) {
            const date = parseDateString(dateStr);
            if (!date || isNaN(date.getTime())) return null;
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            return `${year}-${month}`;
        }

        // Helper function to format month key to display string
        function formatMonthKey(monthKey) {
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            if (!monthKey || monthKey.length < 7) return monthKey || 'Unknown';
            const parts = monthKey.split('-');
            if (parts.length >= 2) {
                const year = parts[0];
                const monIndex = parseInt(parts[1], 10) - 1;
                if (monIndex >= 0 && monIndex < 12) {
                    return `${monthNames[monIndex]} ${year}`;
                }
            }
            return monthKey;
        }

        // ========================================
        // STATUS CALCULATION BASED ON RESOURCE
        // ========================================
        
        // Calculate new status based on resource readiness for Level 5 items
        function calculateResourceBasedStatus(item) {
            // If completed from PDF, keep it
            if (item.originalStatus === 'completed' || item.status === 'completed') {
                return { status: 'completed', statusDisplay: 'âœ… Completed' };
            }
            
            // If not checked yet, return original status
            if (!item.resourceChecked) {
                return { status: item.status, statusDisplay: item.statusDisplay };
            }
            
            // Calculate score
            const score = calculateLevel5Score(item);
            
            // Determine new status based on score
            if (score === 100) {
                return { status: 'ready-to-start', statusDisplay: 'ðŸŸ¢ Ready to Start' };
            } else if (score >= 67) {
                return { status: 'partially-ready', statusDisplay: 'ðŸ”µ Partially Ready' };
            } else if (score >= 34) {
                return { status: 'resources-lacking', statusDisplay: 'ðŸŸ  Resources Lacking' };
            } else {
                // Keep original status but indicate resources not ready
                if (item.originalStatus === 'overdue') {
                    return { status: 'overdue', statusDisplay: 'ðŸ”´ Overdue' };
                }
                return { status: 'not-started', statusDisplay: 'ðŸ•“ Not Started' };
            }
        }

        // Get effective status for display (considering resource input)
        function getEffectiveStatus(item) {
            if (item.level !== 5) {
                return calculateAggregatedStatus(item, workItems);
            }
            return calculateResourceBasedStatus(item);
        }

        function getParentAtLevel(wbs, targetLevel, items) {
            const parts = wbs.split('.');
            if (parts.length <= targetLevel) return null;
            const parentWbs = parts.slice(0, targetLevel).join('.');
            return items.find(item => item.wbs === parentWbs);
        }

        function getArea(item, items) {
            if (item.level === 1) return { wbs: item.wbs, description: item.description };
            const parent = getParentAtLevel(item.wbs, 1, items);
            return parent ? { wbs: parent.wbs, description: parent.description } : { wbs: '-', description: '-' };
        }

        function getDiscipline(item, items) {
            if (item.level <= 2) {
                if (item.level === 2) return { wbs: item.wbs, description: item.description };
                return { wbs: '-', description: '-' };
            }
            const parent = getParentAtLevel(item.wbs, 2, items);
            return parent ? { wbs: parent.wbs, description: parent.description } : { wbs: '-', description: '-' };
        }

        function getLevel5Descendants(parentWbs, items) {
            return items.filter(item => item.level === 5 && item.wbs.startsWith(parentWbs + '.'));
        }

        function calculateAggregatedStatus(item, allItems) {
            if (item.level === 5) return getEffectiveStatus(item);
            
            const children = getLevel5Descendants(item.wbs, allItems);
            if (children.length === 0) return { status: 'unknown', statusDisplay: '-' };
            
            const statuses = children.map(c => getEffectiveStatus(c).status);
            
            if (statuses.includes('overdue')) return { status: 'overdue', statusDisplay: 'ðŸ”´ Overdue' };
            if (statuses.includes('at-risk')) return { status: 'at-risk', statusDisplay: 'ðŸŸ¡ At Risk' };
            if (statuses.every(s => s === 'completed')) return { status: 'completed', statusDisplay: 'âœ… Completed' };
            if (statuses.every(s => s === 'ready-to-start' || s === 'completed')) return { status: 'ready-to-start', statusDisplay: 'ðŸŸ¢ Ready to Start' };
            if (statuses.includes('ready-to-start') || statuses.includes('partially-ready')) return { status: 'in-progress', statusDisplay: 'ðŸ”„ In Progress' };
            if (statuses.includes('not-started')) {
                if (statuses.includes('completed') || statuses.includes('ready-to-start')) return { status: 'in-progress', statusDisplay: 'ðŸ”„ In Progress' };
                return { status: 'not-started', statusDisplay: 'ðŸ•“ Not Started' };
            }
            return { status: 'in-progress', statusDisplay: 'ðŸ”„ In Progress' };
        }

        function calculateLevel5Score(item) {
            if (item.status === 'completed' || item.originalStatus === 'completed') return 100;
            let score = 0;
            resourceTypes.forEach(r => {
                if (item.resources[r].status === 'ready') score += 100;
                else if (item.resources[r].status === 'pending') score += 50;
            });
            return Math.round(score / 6);
        }

        function calculateAggregatedScore(item, allItems) {
            if (item.level === 5) return calculateLevel5Score(item);
            const children = getLevel5Descendants(item.wbs, allItems);
            if (children.length === 0) return null;
            const scores = children.map(c => calculateLevel5Score(c));
            return Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
        }

        function calculateLevel5Risk(item) {
            const effectiveStatus = getEffectiveStatus(item);
            if (effectiveStatus.status === 'completed' || effectiveStatus.status === 'ready-to-start') {
                return { level: 'low', label: 'Low', color: 'low', factors: 'Item sudah completed/ready' };
            }
            const score = calculateLevel5Score(item);
            const planStart = item.planStart ? parseDateString(item.planStart) : null;
            let daysUntilStart = planStart ? Math.ceil((planStart - new Date()) / (1000 * 60 * 60 * 24)) : 999;
            
            // Build factors string
            let factors = [];
            if (score <= 50) factors.push(`Resource score rendah (${score}%)`);
            if (daysUntilStart <= 0) factors.push(`Sudah overdue ${Math.abs(daysUntilStart)} hari`);
            else if (daysUntilStart <= 7) factors.push(`Hanya ${daysUntilStart} hari lagi`);
            else if (daysUntilStart <= 14) factors.push(`${daysUntilStart} hari lagi`);
            if (item.originalStatus === 'overdue') factors.push('Status awal overdue');
            
            // Check resource details
            const notReadyResources = resourceTypes.filter(r => item.resources[r].status === 'not-ready');
            if (notReadyResources.length > 0) {
                factors.push(`${notReadyResources.length} resource belum ready`);
            }
            
            const factorsStr = factors.length > 0 ? factors.join('; ') : 'Dalam batas normal';
            
            if (score <= 16) {
                if (daysUntilStart <= 14 || item.originalStatus === 'overdue') return { level: 'critical', label: 'Critical', color: 'critical', factors: factorsStr };
                return { level: 'high', label: 'High', color: 'high', factors: factorsStr };
            } else if (score <= 50) {
                if (daysUntilStart <= 14 || item.originalStatus === 'overdue') return { level: 'high', label: 'High', color: 'high', factors: factorsStr };
                return { level: 'medium', label: 'Medium', color: 'medium', factors: factorsStr };
            } else if (score <= 83) {
                if (daysUntilStart <= 7 || item.originalStatus === 'overdue') return { level: 'medium', label: 'Medium', color: 'medium', factors: factorsStr };
                return { level: 'low', label: 'Low', color: 'low', factors: factorsStr };
            }
            return { level: 'low', label: 'Low', color: 'low', factors: factorsStr };
        }

        function calculateAggregatedRisk(item, allItems) {
            if (item.level === 5) return calculateLevel5Risk(item);
            
            const aggStatus = calculateAggregatedStatus(item, allItems);
            if (aggStatus.status === 'completed' || aggStatus.status === 'ready-to-start') return { level: 'low', label: 'Low', color: 'low', factors: 'Semua child items ready/completed' };
            
            const children = getLevel5Descendants(item.wbs, allItems).filter(c => {
                const s = getEffectiveStatus(c).status;
                return s !== 'completed' && s !== 'ready-to-start';
            });
            if (children.length === 0) return { level: 'low', label: 'Low', color: 'low', factors: 'Tidak ada child items berisiko' };
            
            const risks = children.map(c => calculateLevel5Risk(c));
            const riskOrder = ['critical', 'high', 'medium', 'low'];
            for (const r of riskOrder) {
                const matchingRisks = risks.filter(risk => risk.level === r);
                if (matchingRisks.length > 0) {
                    return { level: r, label: r.charAt(0).toUpperCase() + r.slice(1), color: r, factors: `${matchingRisks.length} child items dengan risk ${r}` };
                }
            }
            return { level: 'low', label: 'Low', color: 'low', factors: 'Dalam batas normal' };
        }

        function getItemDisplayData(item, allItems) {
            const effectiveStatus = item.level === 5 ? getEffectiveStatus(item) : calculateAggregatedStatus(item, allItems);
            return {
                status: effectiveStatus.status,
                statusDisplay: effectiveStatus.statusDisplay,
                score: calculateAggregatedScore(item, allItems),
                risk: item.level === 5 ? calculateLevel5Risk(item) : calculateAggregatedRisk(item, allItems)
            };
        }

        function parseDate(dateStr) {
            if (!dateStr) return null;
            const months = { 'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5, 'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11 };
            const match = dateStr.match(/(\d{1,2})-([A-Za-z]{3})-(\d{2,4})/);
            if (match) { let year = parseInt(match[3]); if (year < 100) year += 2000; return new Date(year, months[match[2]], parseInt(match[1])); }
            return null;
        }

        function formatDate(dateStr) { return dateStr || '-'; }
        function createDefaultResources() { return resourceTypes.reduce((acc, r) => { acc[r] = { status: 'not-ready', description: '', estimatedDate: '' }; return acc; }, {}); }
        function hasResourceData(resources) { return resourceTypes.some(r => resources[r].status !== 'not-ready' || resources[r].description !== '' || resources[r].estimatedDate !== ''); }

        function initRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Engineering', 'Material', 'Work Force', 'Workfront', 'Equipment', 'Tools'],
                    datasets: [{
                        label: 'Resource Readiness',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(255, 107, 44, 0.2)',
                        borderColor: 'rgba(255, 107, 44, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(255, 107, 44, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(255, 107, 44, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true, max: 100, min: 0,
                            ticks: { stepSize: 25, color: '#8fa3bf', backdropColor: 'transparent', font: { size: 9 } },
                            grid: { color: 'rgba(42, 53, 69, 0.8)' },
                            angleLines: { color: 'rgba(42, 53, 69, 0.8)' },
                            pointLabels: { color: '#e8edf4', font: { size: 10, weight: '600' } }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateRadarChart() {
            if (!radarChart) return;
            const data = resourceTypes.map(r => {
                const status = document.getElementById(`input-${r}-status`).value;
                return status === 'ready' ? 100 : status === 'pending' ? 50 : 0;
            });
            radarChart.data.datasets[0].data = data;
            const avgScore = data.reduce((a, b) => a + b, 0) / data.length;
            let color = avgScore <= 33 ? { bg: 'rgba(235, 87, 87, 0.2)', border: 'rgba(235, 87, 87, 1)' } :
                        avgScore <= 66 ? { bg: 'rgba(242, 201, 76, 0.2)', border: 'rgba(242, 201, 76, 1)' } :
                        { bg: 'rgba(39, 174, 96, 0.2)', border: 'rgba(39, 174, 96, 1)' };
            radarChart.data.datasets[0].backgroundColor = color.bg;
            radarChart.data.datasets[0].borderColor = color.border;
            radarChart.data.datasets[0].pointBackgroundColor = color.border;
            radarChart.update();
        }

        // Update status preview
        function updateStatusPreview() {
            if (!selectedItemId) return;
            const item = workItems.find(i => i.id === selectedItemId);
            if (!item) return;
            
            // Old status
            const oldStatusEl = document.getElementById('previewOldStatus');
            oldStatusEl.className = `status-badge ${item.originalStatus || item.status}`;
            oldStatusEl.textContent = item.originalStatusDisplay || item.statusDisplay;
            
            // Calculate new status based on current inputs
            let score = 0;
            resourceTypes.forEach(r => {
                const s = document.getElementById(`input-${r}-status`).value;
                if (s === 'ready') score += 100;
                else if (s === 'pending') score += 50;
            });
            score = Math.round(score / 6);
            
            let newStatus, newStatusDisplay;
            if (score === 100) {
                newStatus = 'ready-to-start';
                newStatusDisplay = 'ðŸŸ¢ Ready to Start';
            } else if (score >= 67) {
                newStatus = 'partially-ready';
                newStatusDisplay = 'ðŸ”µ Partially Ready';
            } else if (score >= 34) {
                newStatus = 'resources-lacking';
                newStatusDisplay = 'ðŸŸ  Resources Lacking';
            } else {
                newStatus = item.originalStatus || item.status;
                newStatusDisplay = item.originalStatusDisplay || item.statusDisplay;
            }
            
            const newStatusEl = document.getElementById('previewNewStatus');
            newStatusEl.className = `status-badge ${newStatus}`;
            newStatusEl.textContent = newStatusDisplay;
        }

        function initResourceGrid() {
            document.getElementById('resourceGrid').innerHTML = resourceTypes.map(r => `
                <div class="resource-card">
                    <div class="resource-card-header">
                        <div class="resource-card-title"><div class="resource-icon ${r}">${resourceLabels[r].icon}</div><h4>${resourceLabels[r].name}</h4></div>
                        <span class="resource-status-badge not-ready" id="badge-${r}">Not Ready</span>
                    </div>
                    <div class="resource-card-body">
                        <p style="font-size: 10px; color: var(--text-secondary); margin-bottom: 12px;">${resourceLabels[r].desc}</p>
                        <div class="form-group"><label>Status Kesiapan</label><select id="input-${r}-status" onchange="updateResourceBadge('${r}'); updateScoreDisplay(); updateRadarChart(); updateStatusPreview();"><option value="not-ready">âŒ Tidak Siap</option><option value="pending">â³ Dalam Proses</option><option value="ready">âœ… Siap</option></select></div>
                        <div class="form-group"><label>Deskripsi Kondisi</label><textarea id="input-${r}-desc" placeholder="Jelaskan kondisi ${resourceLabels[r].name.toLowerCase()}..."></textarea></div>
                        <div class="form-group"><label>Estimasi Ketersediaan</label><input type="date" id="input-${r}-date"></div>
                    </div>
                </div>
            `).join('');
        }

        function updateResourceBadge(resource) {
            const status = document.getElementById(`input-${resource}-status`).value;
            const badge = document.getElementById(`badge-${resource}`);
            badge.className = `resource-status-badge ${status}`;
            badge.textContent = status === 'ready' ? 'Ready' : status === 'pending' ? 'Pending' : 'Not Ready';
        }

        function updateScoreDisplay() {
            if (!selectedItemId) return;
            let score = 0;
            resourceTypes.forEach(r => { const s = document.getElementById(`input-${r}-status`).value; if (s === 'ready') score += 100; else if (s === 'pending') score += 50; });
            score = Math.round(score / 6);
            const circle = document.getElementById('scoreCircle');
            document.getElementById('scoreValue').textContent = score + '%';
            circle.classList.remove('low', 'medium', 'high');
            circle.classList.add(score <= 33 ? 'low' : score <= 66 ? 'medium' : 'high');
            
            const item = workItems.find(i => i.id === selectedItemId);
            if (item) {
                const tempItem = { ...item, resources: {}, resourceChecked: true };
                resourceTypes.forEach(r => { tempItem.resources[r] = { status: document.getElementById(`input-${r}-status`).value }; });
                const risk = calculateLevel5Risk(tempItem);
                const riskBadge = document.getElementById('riskBadge');
                riskBadge.className = `risk-badge ${risk.color}`;
                riskBadge.textContent = risk.label;
                
                const readyCount = resourceTypes.filter(r => document.getElementById(`input-${r}-status`).value === 'ready').length;
                const pendingCount = resourceTypes.filter(r => document.getElementById(`input-${r}-status`).value === 'pending').length;
                const planStart = item.planStart ? parseDate(item.planStart) : null;
                const daysUntilStart = planStart ? Math.ceil((planStart - new Date()) / (1000 * 60 * 60 * 24)) : null;
                let factors = `â€¢ Resource Ready: ${readyCount}/6, Pending: ${pendingCount}/6\n`;
                if (daysUntilStart !== null) factors += daysUntilStart < 0 ? `â€¢ Plan Start: ${Math.abs(daysUntilStart)} hari yang lalu (OVERDUE)\n` : `â€¢ Plan Start: ${daysUntilStart} hari lagi\n`;
                factors += `â€¢ Status Awal: ${item.originalStatusDisplay || item.statusDisplay}`;
                document.getElementById('riskFactors').textContent = factors;
            }
        }

        function goToResourcePage(itemId) {
            selectedItemId = itemId;
            const item = workItems.find(i => i.id === itemId);
            if (!item) return;
            
            document.getElementById('resourceWBS').textContent = item.wbs;
            document.getElementById('resourceDescription').textContent = item.description;
            document.getElementById('resourcePlanStart').textContent = formatDate(item.planStart);
            const statusBadge = document.getElementById('resourceStatus');
            statusBadge.className = `status-badge ${item.originalStatus || item.status}`;
            statusBadge.textContent = item.originalStatusDisplay || item.statusDisplay;
            
            const area = getArea(item, workItems);
            const discipline = getDiscipline(item, workItems);
            document.getElementById('resourceArea').innerHTML = area.wbs !== '-' ? `<span class="wbs-small">${area.wbs}</span>${area.description}` : '-';
            document.getElementById('resourceDiscipline').innerHTML = discipline.wbs !== '-' ? `<span class="wbs-small">${discipline.wbs}</span>${discipline.description}` : '-';
            
            resourceTypes.forEach(r => {
                document.getElementById(`input-${r}-status`).value = item.resources[r].status;
                document.getElementById(`input-${r}-desc`).value = item.resources[r].description;
                document.getElementById(`input-${r}-date`).value = item.resources[r].estimatedDate;
                updateResourceBadge(r);
            });
            
            updateScoreDisplay();
            updateRadarChart();
            updateStatusPreview();
            
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('resourcePage').classList.add('active');
            window.scrollTo(0, 0);
        }

        function goBackToMain() {
            document.getElementById('resourcePage').classList.remove('active');
            document.getElementById('mainPage').classList.add('active');
            window.scrollTo(0, 0);
        }

        function saveAllResources() {
            if (!selectedItemId) return;
            const item = workItems.find(i => i.id === selectedItemId);
            if (!item) return;
            
            // Save original status if not saved yet
            if (!item.originalStatus) {
                item.originalStatus = item.status;
                item.originalStatusDisplay = item.statusDisplay;
            }
            
            // Save resources
            resourceTypes.forEach(r => {
                item.resources[r] = { 
                    status: document.getElementById(`input-${r}-status`).value, 
                    description: document.getElementById(`input-${r}-desc`).value, 
                    estimatedDate: document.getElementById(`input-${r}-date`).value 
                };
            });
            item.resourceChecked = true;
            
            // Calculate and update status based on resources
            const newStatus = calculateResourceBasedStatus(item);
            item.status = newStatus.status;
            item.statusDisplay = newStatus.statusDisplay;
            
            saveToStorage(); 
            updateStats(); 
            applyFilters();
            
            showToast('Resource disimpan & Status diupdate', 'success');
            goBackToMain();
        }

        const uploadZone = document.getElementById('uploadZone');
        uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
        uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
        uploadZone.addEventListener('drop', e => { e.preventDefault(); uploadZone.classList.remove('dragover'); if (e.dataTransfer.files[0]?.type === 'application/pdf') processPDF(e.dataTransfer.files[0]); else showToast('Hanya file PDF yang didukung', 'error'); });

        function handleFileUpload(event) { const file = event.target.files[0]; if (file?.type === 'application/pdf') processPDF(file); else showToast('Hanya file PDF yang didukung', 'error'); event.target.value = ''; }

        async function processPDF(file) {
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            progressContainer.classList.add('show');
            progressFill.style.width = '0%';
            progressText.textContent = 'Membaca file...';

            try {
                const arrayBuffer = await file.arrayBuffer();
                progressFill.style.width = '10%';
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                let newItems = [];
                
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    progressText.textContent = `Memproses halaman ${pageNum}/${pdf.numPages}...`;
                    progressFill.style.width = (10 + (pageNum / pdf.numPages) * 60) + '%';
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    const items = textContent.items.map(item => ({ text: item.str.trim(), x: Math.round(item.transform[4]), y: Math.round(item.transform[5]) })).filter(item => item.text.length > 0);
                    const rows = {};
                    items.forEach(item => { const yKey = Math.round(item.y / 8) * 8; if (!rows[yKey]) rows[yKey] = []; rows[yKey].push(item); });
                    Object.keys(rows).sort((a, b) => b - a).forEach(yKey => { const row = rows[yKey].sort((a, b) => a.x - b.x); const parsed = parseRow(row.map(r => r.text).join(' ')); if (parsed) newItems.push(parsed); });
                }

                const uniqueNewItems = removeDuplicates(newItems);
                const mergeResult = mergeWorkItems(workItems, uniqueNewItems);
                
                workItems = mergeResult.items;
                workItems.sort((a, b) => compareWBS(a.wbs, b.wbs));
                saveToStorage(); applyFilters(); updateStats(); showImportResult(mergeResult);
                progressFill.style.width = '100%';
                progressText.textContent = `âœ“ Selesai: ${mergeResult.newCount} baru, ${mergeResult.updatedCount} update`;
                showToast(`Import selesai: ${mergeResult.newCount} item baru, ${mergeResult.updatedCount} item diupdate`, 'success');
                setTimeout(() => progressContainer.classList.remove('show'), 3000);
            } catch (error) { console.error('PDF Error:', error); progressContainer.classList.remove('show'); showToast('Gagal memproses PDF: ' + error.message, 'error'); }
        }

        function mergeWorkItems(existingItems, newItems) {
            const existingMap = new Map(); existingItems.forEach(item => existingMap.set(item.wbs, item));
            let newCount = 0, updatedCount = 0, preservedCount = 0;
            const mergedItems = [];
            newItems.forEach(newItem => {
                if (existingMap.has(newItem.wbs)) {
                    const existingItem = existingMap.get(newItem.wbs);
                    const hasResources = hasResourceData(existingItem.resources);
                    mergedItems.push({ 
                        ...newItem, 
                        resources: existingItem.resources, 
                        resourceChecked: existingItem.resourceChecked,
                        originalStatus: existingItem.originalStatus || newItem.status,
                        originalStatusDisplay: existingItem.originalStatusDisplay || newItem.statusDisplay,
                        // Keep calculated status if resource was checked
                        status: existingItem.resourceChecked ? existingItem.status : newItem.status,
                        statusDisplay: existingItem.resourceChecked ? existingItem.statusDisplay : newItem.statusDisplay
                    });
                    updatedCount++; if (hasResources) preservedCount++;
                } else { 
                    mergedItems.push({ 
                        ...newItem, 
                        resources: createDefaultResources(), 
                        resourceChecked: false,
                        originalStatus: newItem.status,
                        originalStatusDisplay: newItem.statusDisplay
                    }); 
                    newCount++; 
                }
            });
            return { items: mergedItems, newCount, updatedCount, preservedCount, totalCount: mergedItems.length };
        }

        function showImportResult(result) {
            document.getElementById('resultTotal').textContent = result.totalCount;
            document.getElementById('resultNew').textContent = result.newCount;
            document.getElementById('resultUpdated').textContent = result.updatedCount;
            document.getElementById('resultPreserved').textContent = result.preservedCount;
            document.getElementById('importResult').classList.add('show');
        }

        function parseRow(rowText) {
            if (!rowText || rowText.length < 5) return null;
            if (/^(Lvl|WBS|Description|Start|Finish|Days|Status|UNIT|BQ|ACTUAL|REM|RE-BASELINE|WORK TO BE DONE|\(?\%\)?)/i.test(rowText)) return null;
            let match = rowText.match(/^([1-5])\s+((?:[\d]+\.)+[\d]+)\s+(.+)/);
            if (!match) { match = rowText.match(/^()((?:[\d]+\.)+[\d]+)\s+(.+)/); if (match) match[1] = Math.min(match[2].split('.').length, 5).toString(); }
            if (!match) { match = rowText.match(/^([1-5])\s+([1-9])\s+([A-Z][A-Za-z\s&]+)/); if (match) match = [match[0], match[1], match[2], match[3]]; }
            if (!match) return null;
            let level = parseInt(match[1]) || 1, wbs = match[2], description = match[3];
            if (!wbs || !/^[\d\.]+$/.test(wbs) || wbs.length < 1 || wbs.length > 20) return null;
            let planStart = null; const dateMatch = rowText.match(/(\d{1,2}-[A-Za-z]{3}-\d{2,4})/); if (dateMatch) planStart = dateMatch[1];
            let status = 'unknown', statusDisplay = '-';
            if (rowText.includes('âœ…') || /\bCompleted\b/i.test(rowText)) { status = 'completed'; statusDisplay = 'âœ… Completed'; }
            else if (rowText.includes('ðŸ”´') || /Not Started.*Overdue|Overdue/i.test(rowText)) { status = 'overdue'; statusDisplay = 'ðŸ”´ Overdue'; }
            else if (rowText.includes('ðŸ•“') || /\bNot Started\b/i.test(rowText)) { status = 'not-started'; statusDisplay = 'ðŸ•“ Not Started'; }
            else if (rowText.includes('ðŸŸ¡') || /At Risk|Potential Delay/i.test(rowText)) { status = 'at-risk'; statusDisplay = 'ðŸŸ¡ At Risk'; }
            else if (rowText.includes('âš ') || /Late Start/i.test(rowText)) { status = 'at-risk'; statusDisplay = 'âš  Late Start'; }
            description = description.replace(/\d{1,2}[-\/][A-Za-z]{3}[-\/]\d{2,4}/g, '').replace(/\d{1,2}[-\/]\d{1,2}[-\/]\d{2,4}/g, '').replace(/[âœ…ðŸ”´ðŸ•“ðŸŸ¡âš ]/g, '').replace(/\b(Completed|Not Started|Overdue|At Risk|Potential Delay|Late Start)\b/gi, '').replace(/\([^)]*\)/g, '').replace(/\b(Lot|m'|m2|m3|M2|M3|Ton|ton|Nos|nos|Dia Inch|Hole|hole|pcs|unit|set)\b/gi, '').replace(/\s+\d[\d\s,\.]*$/g, '').replace(/[\d,]+\.?\d*\s*%/g, '').replace(/#N\/A|#{2,}/g, '').replace(/\s+\d+(\s+\d+)*\s*$/g, '').replace(/\s+/g, ' ').trim();
            if (!description || description.length < 2 || /^(x|X|\-|\.+|#|N\/A)$/.test(description)) return null;
            return { id: wbs, level, wbs, description, planStart, status, statusDisplay };
        }

        function removeDuplicates(items) { const seen = new Map(); items.forEach(item => { if (!seen.has(item.wbs) || item.description.length > seen.get(item.wbs).description.length) seen.set(item.wbs, item); }); return Array.from(seen.values()); }
        function compareWBS(a, b) { const pa = a.split('.').map(Number), pb = b.split('.').map(Number); for (let i = 0; i < Math.max(pa.length, pb.length); i++) { const diff = (pa[i] || 0) - (pb[i] || 0); if (diff !== 0) return diff; } return 0; }

        function applyFilters() {
            filteredItems = workItems.filter(item => {
                const displayData = getItemDisplayData(item, workItems);
                let matchesFilter = false;
                switch(currentFilter) {
                    case 'all': matchesFilter = true; break;
                    case 'level5-all': matchesFilter = item.level === 5; break;
                    case 'level5-pending': matchesFilter = item.level === 5 && displayData.status !== 'completed' && displayData.status !== 'ready-to-start'; break;
                    case 'ready-to-start': matchesFilter = displayData.status === 'ready-to-start'; break;
                    case 'critical': matchesFilter = displayData.risk?.level === 'critical'; break;
                    case 'completed': matchesFilter = displayData.status === 'completed'; break;
                    default: matchesFilter = true;
                }
                const matchesSearch = !searchQuery || item.wbs.toLowerCase().includes(searchQuery.toLowerCase()) || item.description.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesFilter && matchesSearch;
            });
            renderWorkItems();
        }

        function filterItems(filter, element) { currentFilter = filter; document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active')); element?.classList.add('active'); applyFilters(); }
        function searchItems() { searchQuery = document.getElementById('searchInput').value; applyFilters(); }

        function renderWorkItems() {
            const tbody = document.getElementById('workItemsBody');
            document.getElementById('itemCount').innerHTML = `Menampilkan <strong>${filteredItems.length}</strong> dari ${workItems.length} item`;
            if (filteredItems.length === 0) { tbody.innerHTML = `<tr><td colspan="8"><div class="empty-state"><div class="empty-state-icon">ðŸ“‹</div><h3>Tidak Ada Data</h3><p>${workItems.length ? 'Tidak ada item dengan filter ini' : 'Import file PDF'}</p></div></td></tr>`; return; }

            tbody.innerHTML = filteredItems.map(item => {
                const displayData = getItemDisplayData(item, workItems);
                const score = displayData.score;
                const risk = displayData.risk;
                const scoreClass = score !== null ? (score <= 33 ? 'low' : score <= 66 ? 'medium' : 'high') : '';
                
                let actionButton = '';
                if (item.level === 5) {
                    if (displayData.status === 'completed') actionButton = `<button class="action-btn completed-auto" title="Completed">âœ“ Done</button>`;
                    else if (displayData.status === 'ready-to-start') actionButton = `<button class="action-btn checked" onclick="goToResourcePage('${item.id}')" title="Ready - Click to edit">âœ“ Ready</button>`;
                    else actionButton = `<button class="action-btn ${item.resourceChecked ? 'checked' : ''}" onclick="goToResourcePage('${item.id}')">${item.resourceChecked ? 'âœ“ Edit' : 'ðŸ”§ Cek'}</button>`;
                } else {
                    actionButton = `<button class="action-btn auto" title="Dihitung otomatis dari Level 5">ðŸ“Š Auto</button>`;
                }
                
                return `<tr class="level-${item.level}">
                    <td><span class="item-level level-${item.level}">${item.level}</span></td>
                    <td><span class="wbs-code">${item.wbs}</span></td>
                    <td><span class="item-name indent-${item.level}">${item.description}</span></td>
                    <td><span class="plan-date">${formatDate(item.planStart)}</span></td>
                    <td><span class="status-badge ${displayData.status}">${displayData.statusDisplay}</span></td>
                    <td>${score !== null ? `<div class="resource-score"><div class="score-bar"><div class="score-fill ${scoreClass}" style="width: ${score}%"></div></div><span class="score-text">${score}%</span></div>` : '<span style="color: var(--text-muted); font-size: 9px;">-</span>'}</td>
                    <td>${risk && risk.level !== 'unknown' ? `<span class="risk-badge ${risk.color}">${risk.label}</span>` : '<span style="color: var(--text-muted); font-size: 9px;">-</span>'}</td>
                    <td>${actionButton}</td>
                </tr>`;
            }).join('');
        }

        function updateStats() {
            const total = workItems.length;
            const level5Items = workItems.filter(i => i.level === 5);
            let notStarted = 0, overdue = 0, completed = 0, readyToStart = 0, criticalItems = 0, highRiskItems = 0;
            
            workItems.forEach(item => { 
                const d = getItemDisplayData(item, workItems); 
                if (d.status === 'not-started') notStarted++; 
                if (d.status === 'overdue') overdue++; 
                if (d.status === 'completed') completed++;
                if (d.status === 'ready-to-start') readyToStart++;
            });
            
            level5Items.filter(i => {
                const s = getEffectiveStatus(i).status;
                return s !== 'completed' && s !== 'ready-to-start';
            }).forEach(item => { 
                const risk = calculateLevel5Risk(item); 
                if (risk.level === 'critical') criticalItems++; 
                if (risk.level === 'high' || risk.level === 'critical') highRiskItems++; 
            });

            const pendingCheck = level5Items.filter(i => {
                const s = getEffectiveStatus(i).status;
                return s !== 'completed' && s !== 'ready-to-start';
            }).length;

            document.getElementById('totalItems').textContent = total;
            document.getElementById('notStartedItems').textContent = notStarted;
            document.getElementById('overdueItems').textContent = overdue;
            document.getElementById('completedItems').textContent = completed;
            document.getElementById('readyToStartItems').textContent = readyToStart;
            document.getElementById('pendingResource').textContent = pendingCheck;
            document.getElementById('highRiskItems').textContent = highRiskItems;
            document.getElementById('criticalItems').textContent = criticalItems;
        }

        function showSummaryModal() {
            const level5Items = workItems.filter(i => i.level === 5);
            const level5Completed = level5Items.filter(i => getEffectiveStatus(i).status === 'completed');
            const level5Ready = level5Items.filter(i => getEffectiveStatus(i).status === 'ready-to-start');
            const level5Pending = level5Items.filter(i => {
                const s = getEffectiveStatus(i).status;
                return s !== 'completed' && s !== 'ready-to-start';
            });
            const critical = level5Pending.filter(i => calculateLevel5Risk(i).level === 'critical').length;
            const high = level5Pending.filter(i => calculateLevel5Risk(i).level === 'high').length;

            document.getElementById('summaryTotal').textContent = level5Items.length;
            document.getElementById('summaryCompleted').textContent = level5Completed.length;
            document.getElementById('summaryReady').textContent = level5Ready.length;
            document.getElementById('summaryCritical').textContent = critical;
            document.getElementById('summaryHighRisk').textContent = high;

            const tbody = document.getElementById('summaryTableBody');
            tbody.innerHTML = level5Items.length === 0 ? '<tr><td colspan="14" style="text-align:center">Tidak ada item</td></tr>' : level5Items.slice(0, 100).map(item => {
                const effectiveStatus = getEffectiveStatus(item);
                const score = calculateLevel5Score(item);
                const risk = calculateLevel5Risk(item);
                const isComplete = effectiveStatus.status === 'completed';
                const isReady = effectiveStatus.status === 'ready-to-start';
                const area = getArea(item, workItems);
                const discipline = getDiscipline(item, workItems);
                return `<tr>
                    <td><span class="wbs-code">${item.wbs}</span></td>
                    <td>${item.description.substring(0, 25)}${item.description.length > 25 ? '...' : ''}</td>
                    <td style="font-size:9px;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="${area.description}">${area.description.substring(0, 20)}${area.description.length > 20 ? '...' : ''}</td>
                    <td style="font-size:9px;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="${discipline.description}">${discipline.description.substring(0, 20)}${discipline.description.length > 20 ? '...' : ''}</td>
                    <td><span class="plan-date">${formatDate(item.planStart)}</span></td>
                    <td><span class="status-badge ${effectiveStatus.status}" style="font-size:7px;padding:2px 4px;">${effectiveStatus.statusDisplay}</span></td>
                    <td>${score}%</td>
                    <td><span class="risk-badge ${risk.color}" style="font-size:7px;padding:2px 5px;">${risk.label}</span></td>
                    ${resourceTypes.map(r => (isComplete || isReady) ? `<td style="text-align:center;color:var(--accent-green);font-size:10px;">âœ“</td>` : `<td style="text-align:center;color:${item.resources[r].status === 'ready' ? 'var(--accent-green)' : item.resources[r].status === 'pending' ? 'var(--accent-yellow)' : 'var(--accent-red)'};font-size:10px;">${item.resources[r].status === 'ready' ? 'âœ“' : item.resources[r].status === 'pending' ? 'â³' : 'âœ—'}</td>`).join('')}
                </tr>`;
            }).join('');
            document.getElementById('summaryModal').classList.add('show');
        }

        // ========================================
        // DASHBOARD FUNCTIONS
        // ========================================
        
        let dashboardCharts = {};

        function goToDashboard() {
            if (workItems.length === 0) {
                showToast('Import data terlebih dahulu', 'error');
                return;
            }
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('dashboardPage').classList.add('active');
            renderDashboard();
        }

        function goBackFromDashboard() {
            document.getElementById('dashboardPage').classList.remove('active');
            document.getElementById('mainPage').classList.add('active');
            destroyDashboardCharts();
        }

        function refreshDashboard() {
            destroyDashboardCharts();
            renderDashboard();
            showToast('Dashboard di-refresh', 'success');
        }

        // ========================================
        // RISK ANALYSIS FUNCTIONS
        // ========================================
        
        let riskCharts = {};
        let currentRiskFilter = 'all';

        function goToRiskAnalysis() {
            if (workItems.length === 0) {
                showToast('Import data terlebih dahulu', 'error');
                return;
            }
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('riskAnalysisPage').classList.add('active');
            renderRiskAnalysis();
        }

        function goBackFromRiskAnalysis() {
            document.getElementById('riskAnalysisPage').classList.remove('active');
            document.getElementById('mainPage').classList.add('active');
            destroyRiskCharts();
        }

        function refreshRiskAnalysis() {
            destroyRiskCharts();
            renderRiskAnalysis();
            showToast('Risk Analysis di-refresh', 'success');
        }

        function destroyRiskCharts() {
            Object.values(riskCharts).forEach(chart => {
                if (chart) chart.destroy();
            });
            riskCharts = {};
        }

        function calculateRiskStats() {
            const level5Items = workItems.filter(i => i.level === 5);
            const activeItems = level5Items.filter(i => {
                const status = getEffectiveStatus(i).status;
                return status !== 'completed' && status !== 'ready-to-start';
            });

            let critical = 0, high = 0, medium = 0, low = 0;
            const riskItems = [];

            activeItems.forEach(item => {
                const risk = calculateLevel5Risk(item);
                const score = calculateLevel5Score(item);
                const area = getArea(item, workItems);
                const discipline = getDiscipline(item, workItems);
                
                if (risk.level === 'critical') critical++;
                else if (risk.level === 'high') high++;
                else if (risk.level === 'medium') medium++;
                else low++;

                riskItems.push({
                    ...item,
                    risk,
                    score,
                    area,
                    discipline,
                    riskScore: risk.level === 'critical' ? 4 : risk.level === 'high' ? 3 : risk.level === 'medium' ? 2 : 1
                });
            });

            return {
                total: activeItems.length,
                critical,
                high,
                medium,
                low,
                riskItems: riskItems.sort((a, b) => b.riskScore - a.riskScore),
                level5Items,
                completedCount: level5Items.filter(i => getEffectiveStatus(i).status === 'completed').length,
                readyCount: level5Items.filter(i => getEffectiveStatus(i).status === 'ready-to-start').length
            };
        }

        function renderRiskAnalysis() {
            const container = document.getElementById('riskAnalysisContent');
            
            if (workItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-dashboard">
                        <div class="empty-icon">âš ï¸</div>
                        <h3>Belum Ada Data</h3>
                        <p>Import file PDF untuk melihat risk analysis</p>
                    </div>
                `;
                return;
            }

            const stats = calculateRiskStats();
            
            container.innerHTML = `
                <!-- Risk Summary Cards -->
                <div class="risk-summary-grid">
                    <div class="risk-summary-card total">
                        <div class="risk-icon">ðŸ“Š</div>
                        <div class="risk-value">${stats.total}</div>
                        <div class="risk-label">Total At Risk</div>
                        <div class="risk-percent">${stats.level5Items.length} total items</div>
                    </div>
                    <div class="risk-summary-card critical">
                        <div class="risk-icon">ðŸš¨</div>
                        <div class="risk-value">${stats.critical}</div>
                        <div class="risk-label">Critical</div>
                        <div class="risk-percent">${stats.total ? Math.round((stats.critical / stats.total) * 100) : 0}% of at-risk</div>
                    </div>
                    <div class="risk-summary-card high">
                        <div class="risk-icon">ðŸ”´</div>
                        <div class="risk-value">${stats.high}</div>
                        <div class="risk-label">High Risk</div>
                        <div class="risk-percent">${stats.total ? Math.round((stats.high / stats.total) * 100) : 0}% of at-risk</div>
                    </div>
                    <div class="risk-summary-card medium">
                        <div class="risk-icon">ðŸŸ¡</div>
                        <div class="risk-value">${stats.medium}</div>
                        <div class="risk-label">Medium Risk</div>
                        <div class="risk-percent">${stats.total ? Math.round((stats.medium / stats.total) * 100) : 0}% of at-risk</div>
                    </div>
                    <div class="risk-summary-card low">
                        <div class="risk-icon">ðŸŸ¢</div>
                        <div class="risk-value">${stats.low}</div>
                        <div class="risk-label">Low Risk</div>
                        <div class="risk-percent">${stats.total ? Math.round((stats.low / stats.total) * 100) : 0}% of at-risk</div>
                    </div>
                </div>

                <!-- Risk Charts Row -->
                <div class="risk-trend-section">
                    <div class="chart-panel">
                        <h3>ðŸ“Š <span>Risk Distribution</span></h3>
                        <div class="chart-container">
                            <canvas id="riskDistChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-panel">
                        <h3>ðŸ“ˆ <span>Risk by Area</span></h3>
                        <div class="chart-container">
                            <canvas id="riskByAreaChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Risk Heatmap by Discipline -->
                <div class="risk-heatmap">
                    <h3>ðŸ”¥ <span>Risk Heatmap by Discipline</span></h3>
                    <div id="riskHeatmapContainer"></div>
                </div>

                <!-- Risk Trend Chart -->
                <div class="chart-panel" style="margin-bottom: 20px;">
                    <h3>ðŸ“‰ <span>Risk Score Trend by Plan Start</span></h3>
                    <div class="chart-container">
                        <canvas id="riskTrendChart"></canvas>
                    </div>
                </div>

                <!-- Risk Register -->
                <div class="risk-register-panel">
                    <div class="risk-register-header">
                        <h3>ðŸ“‹ Risk Register</h3>
                        <div class="risk-filter-tabs">
                            <button class="risk-filter-tab ${currentRiskFilter === 'all' ? 'active' : ''}" onclick="filterRiskRegister('all', this)">All (${stats.total})</button>
                            <button class="risk-filter-tab ${currentRiskFilter === 'critical' ? 'active' : ''}" onclick="filterRiskRegister('critical', this)">Critical (${stats.critical})</button>
                            <button class="risk-filter-tab ${currentRiskFilter === 'high' ? 'active' : ''}" onclick="filterRiskRegister('high', this)">High (${stats.high})</button>
                            <button class="risk-filter-tab ${currentRiskFilter === 'medium' ? 'active' : ''}" onclick="filterRiskRegister('medium', this)">Medium (${stats.medium})</button>
                            <button class="risk-filter-tab ${currentRiskFilter === 'low' ? 'active' : ''}" onclick="filterRiskRegister('low', this)">Low (${stats.low})</button>
                        </div>
                    </div>
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="risk-register-table">
                            <thead>
                                <tr>
                                    <th>Risk ID</th>
                                    <th>WBS</th>
                                    <th>Description</th>
                                    <th>Area</th>
                                    <th>Discipline</th>
                                    <th>Plan Start</th>
                                    <th>Risk Level</th>
                                    <th>Resource Score</th>
                                    <th>Risk Factors</th>
                                </tr>
                            </thead>
                            <tbody id="riskRegisterBody"></tbody>
                        </table>
                    </div>
                </div>
            `;

            // Render all risk charts
            setTimeout(() => {
                renderRiskDistChart(stats);
                renderRiskByAreaChart(stats);
                renderRiskHeatmap(stats);
                renderRiskTrendChart(stats);
                renderRiskRegisterTable(stats);
            }, 100);
        }

        function renderRiskDistChart(stats) {
            const ctx = document.getElementById('riskDistChart');
            if (!ctx) return;

            riskCharts.dist = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'High', 'Medium', 'Low'],
                    datasets: [{
                        data: [stats.critical, stats.high, stats.medium, stats.low],
                        backgroundColor: ['#ff1744', '#eb5757', '#f2c94c', '#27ae60'],
                        borderWidth: 0,
                        spacing: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#8fa3bf', font: { size: 11 }, padding: 15, usePointStyle: true }
                        }
                    }
                }
            });
        }

        function renderRiskByAreaChart(stats) {
            const ctx = document.getElementById('riskByAreaChart');
            if (!ctx) return;

            const areaRisks = {};
            stats.riskItems.forEach(item => {
                const areaName = item.area.description;
                if (!areaRisks[areaName]) {
                    areaRisks[areaName] = { critical: 0, high: 0, medium: 0, low: 0 };
                }
                areaRisks[areaName][item.risk.level]++;
            });

            const sortedAreas = Object.entries(areaRisks)
                .sort((a, b) => (b[1].critical + b[1].high) - (a[1].critical + a[1].high))
                .slice(0, 8);

            riskCharts.byArea = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedAreas.map(a => a[0].substring(0, 18) + (a[0].length > 18 ? '...' : '')),
                    datasets: [
                        { label: 'Critical', data: sortedAreas.map(a => a[1].critical), backgroundColor: '#ff1744', borderRadius: 2 },
                        { label: 'High', data: sortedAreas.map(a => a[1].high), backgroundColor: '#eb5757', borderRadius: 2 },
                        { label: 'Medium', data: sortedAreas.map(a => a[1].medium), backgroundColor: '#f2c94c', borderRadius: 2 },
                        { label: 'Low', data: sortedAreas.map(a => a[1].low), backgroundColor: '#27ae60', borderRadius: 2 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: { stacked: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#8fa3bf' } },
                        y: { stacked: true, grid: { display: false }, ticks: { color: '#8fa3bf', font: { size: 9 } } }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { color: '#8fa3bf', font: { size: 9 }, usePointStyle: true, padding: 10 } }
                    }
                }
            });
        }

        function renderRiskHeatmap(stats) {
            const container = document.getElementById('riskHeatmapContainer');
            if (!container) return;

            const disciplines = {};
            const riskLevels = ['critical', 'high', 'medium', 'low'];
            
            stats.riskItems.forEach(item => {
                const discName = item.discipline.description.substring(0, 20);
                if (!disciplines[discName]) {
                    disciplines[discName] = { critical: 0, high: 0, medium: 0, low: 0, total: 0 };
                }
                disciplines[discName][item.risk.level]++;
                disciplines[discName].total++;
            });

            const sortedDisc = Object.entries(disciplines)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 10);

            const getHeatClass = (count, max) => {
                if (count === 0) return 'heat-0';
                const ratio = count / Math.max(max, 1);
                if (ratio > 0.75) return 'heat-4';
                if (ratio > 0.5) return 'heat-3';
                if (ratio > 0.25) return 'heat-2';
                return 'heat-1';
            };

            const maxCount = Math.max(...sortedDisc.flatMap(d => [d[1].critical, d[1].high, d[1].medium, d[1].low]));

            container.innerHTML = `
                <div class="heatmap-grid" style="grid-template-columns: 150px repeat(4, 1fr);">
                    <div class="heatmap-header"></div>
                    <div class="heatmap-header" style="color: #ff1744;">Critical</div>
                    <div class="heatmap-header" style="color: #eb5757;">High</div>
                    <div class="heatmap-header" style="color: #f2c94c;">Medium</div>
                    <div class="heatmap-header" style="color: #27ae60;">Low</div>
                    ${sortedDisc.map(([name, data]) => `
                        <div class="heatmap-row-label" title="${name}">${name}${name.length > 20 ? '...' : ''}</div>
                        <div class="heatmap-cell ${getHeatClass(data.critical, maxCount)}">${data.critical || '-'}</div>
                        <div class="heatmap-cell ${getHeatClass(data.high, maxCount)}">${data.high || '-'}</div>
                        <div class="heatmap-cell ${getHeatClass(data.medium, maxCount)}">${data.medium || '-'}</div>
                        <div class="heatmap-cell ${getHeatClass(data.low, maxCount)}">${data.low || '-'}</div>
                    `).join('')}
                </div>
            `;
        }

        function renderRiskTrendChart(stats) {
            const ctx = document.getElementById('riskTrendChart');
            if (!ctx) return;

            const timeline = {};
            
            stats.riskItems.filter(i => i.planStart).forEach(item => {
                const monthKey = getMonthKey(item.planStart);
                if (monthKey) {
                    if (!timeline[monthKey]) {
                        timeline[monthKey] = { critical: 0, high: 0, medium: 0, low: 0 };
                    }
                    timeline[monthKey][item.risk.level]++;
                }
            });

            const sortedMonths = Object.keys(timeline).sort().slice(0, 12);
            
            if (sortedMonths.length === 0) {
                // No valid data
                return;
            }

            // Calculate cumulative
            let cumCritical = 0, cumHigh = 0, cumMedium = 0, cumLow = 0;
            const cumData = sortedMonths.map(m => {
                cumCritical += timeline[m].critical;
                cumHigh += timeline[m].high;
                cumMedium += timeline[m].medium;
                cumLow += timeline[m].low;
                return { critical: cumCritical, high: cumHigh, medium: cumMedium, low: cumLow };
            });

            // Generate proper labels using helper function
            const labels = sortedMonths.map(m => formatMonthKey(m));

            riskCharts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Critical (Cumulative)',
                            data: cumData.map(d => d.critical),
                            borderColor: '#ff1744',
                            backgroundColor: 'rgba(255, 23, 68, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'High (Cumulative)',
                            data: cumData.map(d => d.high),
                            borderColor: '#eb5757',
                            backgroundColor: 'rgba(235, 87, 87, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Medium (Cumulative)',
                            data: cumData.map(d => d.medium),
                            borderColor: '#f2c94c',
                            backgroundColor: 'rgba(242, 201, 76, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Low (Cumulative)',
                            data: cumData.map(d => d.low),
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            grid: { color: 'rgba(255,255,255,0.05)' }, 
                            ticks: { color: '#8fa3bf', font: { size: 9 }, maxRotation: 45 },
                            title: { display: true, text: 'Plan Start (Month Year)', color: '#8fa3bf', font: { size: 10 } }
                        },
                        y: { 
                            grid: { color: 'rgba(255,255,255,0.05)' }, 
                            ticks: { color: '#8fa3bf' },
                            title: { display: true, text: 'Cumulative Risk Items', color: '#8fa3bf', font: { size: 10 } }
                        }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { color: '#8fa3bf', font: { size: 9 }, usePointStyle: true, padding: 10 } }
                    }
                }
            });
        }

        function renderRiskRegisterTable(stats) {
            const tbody = document.getElementById('riskRegisterBody');
            if (!tbody) return;

            let filteredItems = stats.riskItems;
            if (currentRiskFilter !== 'all') {
                filteredItems = filteredItems.filter(i => i.risk.level === currentRiskFilter);
            }

            if (filteredItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px; color: var(--text-secondary);">Tidak ada item dengan risk level ini</td></tr>';
                return;
            }

            tbody.innerHTML = filteredItems.slice(0, 100).map((item, index) => {
                const riskId = `RSK-${String(index + 1).padStart(4, '0')}`;
                const scoreClass = item.score < 34 ? 'critical' : item.score < 67 ? 'high' : 'medium';
                const factors = item.risk.factors || 'N/A';
                
                return `
                    <tr>
                        <td><span class="risk-id">${riskId}</span></td>
                        <td><span class="wbs-code">${item.wbs}</span></td>
                        <td class="risk-desc">${item.description.substring(0, 40)}${item.description.length > 40 ? '...' : ''}</td>
                        <td style="font-size: 10px;">${item.area.description.substring(0, 20)}${item.area.description.length > 20 ? '...' : ''}</td>
                        <td style="font-size: 10px;">${item.discipline.description.substring(0, 20)}${item.discipline.description.length > 20 ? '...' : ''}</td>
                        <td><span class="plan-date">${formatDate(item.planStart)}</span></td>
                        <td><span class="risk-badge ${item.risk.color}">${item.risk.label}</span></td>
                        <td>
                            <div class="risk-score-cell">
                                <div class="risk-score-bar"><div class="risk-score-fill ${scoreClass}" style="width: ${item.score}%"></div></div>
                                <span style="font-size: 10px; font-weight: 600;">${item.score}%</span>
                            </div>
                        </td>
                        <td class="risk-factors" title="${factors}">${factors.substring(0, 50)}${factors.length > 50 ? '...' : ''}</td>
                    </tr>
                `;
            }).join('');
        }

        function filterRiskRegister(filter, btn) {
            currentRiskFilter = filter;
            document.querySelectorAll('.risk-filter-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            const stats = calculateRiskStats();
            renderRiskRegisterTable(stats);
        }

        function exportRiskRegister() {
            const stats = calculateRiskStats();
            if (stats.riskItems.length === 0) {
                showToast('Tidak ada data risk untuk di-export', 'error');
                return;
            }

            const headers = ['Risk_ID', 'WBS', 'Description', 'Area', 'Discipline', 'Plan_Start', 'Risk_Level', 'Resource_Score', 'Risk_Factors'];
            const rows = stats.riskItems.map((item, index) => {
                const riskId = `RSK-${String(index + 1).padStart(4, '0')}`;
                return [
                    riskId,
                    item.wbs,
                    `"${item.description.replace(/"/g, '""')}"`,
                    `"${item.area.description.replace(/"/g, '""')}"`,
                    `"${item.discipline.description.replace(/"/g, '""')}"`,
                    item.planStart || '',
                    item.risk.label,
                    item.score + '%',
                    `"${item.risk.factors.replace(/"/g, '""')}"`
                ];
            });

            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `risk_register_${new Date().toISOString().slice(0, 10)}.csv`;
            link.click();
            showToast('Risk Register di-export', 'success');
        }

        function destroyDashboardCharts() {
            Object.values(dashboardCharts).forEach(chart => {
                if (chart) chart.destroy();
            });
            dashboardCharts = {};
        }

        function renderDashboard() {
            const container = document.getElementById('dashboardContent');
            
            if (workItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-dashboard">
                        <div class="empty-icon">ðŸ“Š</div>
                        <h3>Belum Ada Data</h3>
                        <p>Import file PDF untuk melihat dashboard analytics</p>
                    </div>
                `;
                return;
            }

            const level5Items = workItems.filter(i => i.level === 5);
            const stats = calculateDashboardStats();
            
            container.innerHTML = `
                <!-- Summary Stats -->
                <div class="dashboard-grid">
                    <div class="dashboard-stat blue">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value-large">${stats.totalLevel5}</div>
                                <div class="stat-label-large">Total Level 5 Items</div>
                            </div>
                            <div class="stat-icon-large">ðŸ“¦</div>
                        </div>
                        <div class="stat-change neutral">dari ${stats.totalItems} total items</div>
                    </div>
                    <div class="dashboard-stat green">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value-large">${stats.readyToStart}</div>
                                <div class="stat-label-large">Ready to Start</div>
                            </div>
                            <div class="stat-icon-large">ðŸš€</div>
                        </div>
                        <div class="stat-change positive">${stats.readyPercent}% siap dikerjakan</div>
                    </div>
                    <div class="dashboard-stat orange">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value-large">${stats.needCheck}</div>
                                <div class="stat-label-large">Need Resource Check</div>
                            </div>
                            <div class="stat-icon-large">â³</div>
                        </div>
                        <div class="stat-change neutral">${stats.needCheckPercent}% perlu dicek</div>
                    </div>
                    <div class="dashboard-stat red">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value-large">${stats.critical}</div>
                                <div class="stat-label-large">Critical Items</div>
                            </div>
                            <div class="stat-icon-large">ðŸš¨</div>
                        </div>
                        <div class="stat-change negative">${stats.highRisk} high risk</div>
                    </div>
                </div>

                <!-- Charts Row 1 -->
                <div class="dashboard-row">
                    <div class="chart-panel">
                        <h3>ðŸ“ˆ <span>Status Distribution</span></h3>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-panel">
                        <h3>âš ï¸ <span>Risk Level Distribution</span></h3>
                        <div class="chart-container">
                            <canvas id="riskChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 2 -->
                <div class="dashboard-row">
                    <div class="chart-panel">
                        <h3>ðŸ—ï¸ <span>Items by Area (Level 1)</span></h3>
                        <div class="chart-container">
                            <canvas id="areaChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-panel">
                        <h3>ðŸ”§ <span>Items by Discipline (Level 2)</span></h3>
                        <div class="chart-container">
                            <canvas id="disciplineChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Resource Readiness Chart -->
                <div class="dashboard-row">
                    <div class="chart-panel">
                        <h3>ðŸ“Š <span>Resource Readiness Overview</span></h3>
                        <div class="chart-container">
                            <canvas id="resourceChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-panel">
                        <h3>ðŸ“ˆ <span>S-Curve: Plan vs Actual Progress</span></h3>
                        <div class="chart-container">
                            <canvas id="scurveChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Area Breakdown -->
                <div class="chart-panel" style="margin-bottom: 20px;">
                    <h3>ðŸ—‚ï¸ <span>Area Breakdown Summary</span></h3>
                    <div class="area-legend">
                        <div class="legend-item"><span class="legend-color total"></span><span class="legend-text">Total Items - Jumlah seluruh item Level 5 di area tersebut</span></div>
                        <div class="legend-item"><span class="legend-color ready"></span><span class="legend-text">Ready/Done âœ“ - Item yang sudah Completed atau Ready to Start</span></div>
                        <div class="legend-item"><span class="legend-color critical"></span><span class="legend-text">Critical ! - Item dengan status Critical Risk yang perlu perhatian segera</span></div>
                    </div>
                    <div class="area-breakdown" id="areaBreakdown"></div>
                </div>

                <!-- Top 10 Critical & High Risk Ranking -->
                <div class="top-rank-panel">
                    <div class="top-rank-header">
                        <h3>ðŸ† Top 10 Critical & High Risk Items</h3>
                        <span style="font-size: 11px; color: var(--text-secondary);">Ranked by urgency & risk severity</span>
                    </div>
                    <div class="top-rank-list" id="topRankList"></div>
                </div>

                <!-- Critical Items List -->
                <div class="critical-list-panel">
                    <div class="critical-list-header">
                        <h3>ðŸš¨ All Critical & High Risk Items</h3>
                        <span class="critical-count">${stats.critical + stats.highRisk} items</span>
                    </div>
                    <div class="critical-list" id="criticalList"></div>
                </div>
            `;

            // Render all charts
            setTimeout(() => {
                renderStatusChart(stats);
                renderRiskChart(stats);
                renderAreaChart();
                renderDisciplineChart();
                renderResourceChart();
                renderSCurveChart();
                renderAreaBreakdown();
                renderTopRankList();
                renderCriticalList();
            }, 100);
        }

        function calculateDashboardStats() {
            const level5Items = workItems.filter(i => i.level === 5);
            let completed = 0, readyToStart = 0, notStarted = 0, overdue = 0;
            let critical = 0, highRisk = 0, mediumRisk = 0, lowRisk = 0;

            level5Items.forEach(item => {
                const status = getEffectiveStatus(item).status;
                if (status === 'completed') completed++;
                else if (status === 'ready-to-start') readyToStart++;
                else if (status === 'overdue') overdue++;
                else notStarted++;

                if (status !== 'completed' && status !== 'ready-to-start') {
                    const risk = calculateLevel5Risk(item);
                    if (risk.level === 'critical') critical++;
                    else if (risk.level === 'high') highRisk++;
                    else if (risk.level === 'medium') mediumRisk++;
                    else lowRisk++;
                }
            });

            const needCheck = level5Items.filter(i => {
                const s = getEffectiveStatus(i).status;
                return s !== 'completed' && s !== 'ready-to-start';
            }).length;

            return {
                totalItems: workItems.length,
                totalLevel5: level5Items.length,
                completed,
                readyToStart,
                notStarted,
                overdue,
                needCheck,
                critical,
                highRisk,
                mediumRisk,
                lowRisk,
                readyPercent: level5Items.length ? Math.round((readyToStart / level5Items.length) * 100) : 0,
                needCheckPercent: level5Items.length ? Math.round((needCheck / level5Items.length) * 100) : 0
            };
        }

        function renderStatusChart(stats) {
            const ctx = document.getElementById('statusChart');
            if (!ctx) return;
            
            dashboardCharts.status = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Ready to Start', 'Not Started', 'Overdue'],
                    datasets: [{
                        data: [stats.completed, stats.readyToStart, stats.notStarted, stats.overdue],
                        backgroundColor: ['#27ae60', '#00bcd4', '#9b51e0', '#eb5757'],
                        borderWidth: 0,
                        spacing: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#8fa3bf', font: { size: 11 }, padding: 15, usePointStyle: true }
                        }
                    }
                }
            });
        }

        function renderRiskChart(stats) {
            const ctx = document.getElementById('riskChart');
            if (!ctx) return;
            
            dashboardCharts.risk = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: ['Critical', 'High Risk', 'Medium Risk', 'Low Risk'],
                    datasets: [{
                        data: [stats.critical, stats.highRisk, stats.mediumRisk, stats.lowRisk],
                        backgroundColor: ['rgba(255, 23, 68, 0.7)', 'rgba(235, 87, 87, 0.7)', 'rgba(242, 201, 76, 0.7)', 'rgba(39, 174, 96, 0.7)'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#8fa3bf', font: { size: 11 }, padding: 15, usePointStyle: true }
                        }
                    },
                    scales: {
                        r: {
                            ticks: { display: false },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        function renderAreaChart() {
            const ctx = document.getElementById('areaChart');
            if (!ctx) return;

            const areas = {};
            workItems.filter(i => i.level === 5).forEach(item => {
                const area = getArea(item, workItems);
                if (!areas[area.description]) {
                    areas[area.description] = { total: 0, ready: 0, critical: 0 };
                }
                areas[area.description].total++;
                const status = getEffectiveStatus(item).status;
                if (status === 'ready-to-start' || status === 'completed') areas[area.description].ready++;
                if (status !== 'completed' && status !== 'ready-to-start') {
                    const risk = calculateLevel5Risk(item);
                    if (risk.level === 'critical' || risk.level === 'high') areas[area.description].critical++;
                }
            });

            const sortedAreas = Object.entries(areas).sort((a, b) => b[1].total - a[1].total).slice(0, 8);
            
            dashboardCharts.area = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedAreas.map(a => a[0].substring(0, 20) + (a[0].length > 20 ? '...' : '')),
                    datasets: [
                        {
                            label: 'Ready/Done',
                            data: sortedAreas.map(a => a[1].ready),
                            backgroundColor: 'rgba(39, 174, 96, 0.8)',
                            borderRadius: 4
                        },
                        {
                            label: 'Critical/High Risk',
                            data: sortedAreas.map(a => a[1].critical),
                            backgroundColor: 'rgba(235, 87, 87, 0.8)',
                            borderRadius: 4
                        },
                        {
                            label: 'Others',
                            data: sortedAreas.map(a => a[1].total - a[1].ready - a[1].critical),
                            backgroundColor: 'rgba(143, 163, 191, 0.5)',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: { stacked: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#8fa3bf' } },
                        y: { stacked: true, grid: { display: false }, ticks: { color: '#8fa3bf', font: { size: 10 } } }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { color: '#8fa3bf', font: { size: 10 }, usePointStyle: true } }
                    }
                }
            });
        }

        function renderDisciplineChart() {
            const ctx = document.getElementById('disciplineChart');
            if (!ctx) return;

            const disciplines = {};
            workItems.filter(i => i.level === 5).forEach(item => {
                const disc = getDiscipline(item, workItems);
                if (!disciplines[disc.description]) {
                    disciplines[disc.description] = { total: 0, ready: 0 };
                }
                disciplines[disc.description].total++;
                const status = getEffectiveStatus(item).status;
                if (status === 'ready-to-start' || status === 'completed') disciplines[disc.description].ready++;
            });

            const sortedDisc = Object.entries(disciplines).sort((a, b) => b[1].total - a[1].total).slice(0, 10);
            
            dashboardCharts.discipline = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedDisc.map(d => d[0].substring(0, 15) + (d[0].length > 15 ? '...' : '')),
                    datasets: [{
                        label: 'Total Items',
                        data: sortedDisc.map(d => d[1].total),
                        backgroundColor: 'rgba(45, 156, 219, 0.8)',
                        borderRadius: 4
                    }, {
                        label: 'Ready/Done',
                        data: sortedDisc.map(d => d[1].ready),
                        backgroundColor: 'rgba(39, 174, 96, 0.8)',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#8fa3bf', font: { size: 9 }, maxRotation: 45 } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#8fa3bf' } }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { color: '#8fa3bf', font: { size: 10 }, usePointStyle: true } }
                    }
                }
            });
        }

        function renderResourceChart() {
            const ctx = document.getElementById('resourceChart');
            if (!ctx) return;

            const resourceStats = {};
            resourceTypes.forEach(r => {
                resourceStats[r] = { ready: 0, pending: 0, notReady: 0 };
            });

            workItems.filter(i => i.level === 5).forEach(item => {
                const status = getEffectiveStatus(item).status;
                if (status === 'completed' || status === 'ready-to-start') {
                    resourceTypes.forEach(r => resourceStats[r].ready++);
                } else {
                    resourceTypes.forEach(r => {
                        if (item.resources[r].status === 'ready') resourceStats[r].ready++;
                        else if (item.resources[r].status === 'pending') resourceStats[r].pending++;
                        else resourceStats[r].notReady++;
                    });
                }
            });

            dashboardCharts.resource = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: resourceTypes.map(r => resourceLabels[r].name),
                    datasets: [{
                        label: 'Ready %',
                        data: resourceTypes.map(r => {
                            const total = resourceStats[r].ready + resourceStats[r].pending + resourceStats[r].notReady;
                            return total ? Math.round((resourceStats[r].ready / total) * 100) : 0;
                        }),
                        backgroundColor: 'rgba(39, 174, 96, 0.2)',
                        borderColor: 'rgba(39, 174, 96, 0.8)',
                        pointBackgroundColor: 'rgba(39, 174, 96, 1)',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#8fa3bf', backdropColor: 'transparent' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            pointLabels: { color: '#8fa3bf', font: { size: 10 } }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function renderSCurveChart() {
            const ctx = document.getElementById('scurveChart');
            if (!ctx) return;

            const level5Items = workItems.filter(i => i.level === 5 && i.planStart);
            if (level5Items.length === 0) return;

            // Get date range using parseDateString helper
            const validDates = level5Items
                .map(i => parseDateString(i.planStart))
                .filter(d => d !== null && !isNaN(d.getTime()))
                .sort((a, b) => a - b);
            
            if (validDates.length === 0) return;
            
            const minDate = validDates[0];
            const maxDate = validDates[validDates.length - 1];
            
            // Create monthly buckets
            const months = [];
            const currentDate = new Date(minDate);
            currentDate.setDate(1);
            
            while (currentDate <= maxDate) {
                months.push(new Date(currentDate));
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            // Add one more month for completion
            months.push(new Date(currentDate));

            const totalItems = level5Items.length;
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            // Calculate Plan cumulative (items planned to start by each month)
            const planCumulative = months.map(month => {
                const count = level5Items.filter(item => {
                    const planDate = parseDateString(item.planStart);
                    return planDate && planDate <= month;
                }).length;
                return Math.round((count / totalItems) * 100);
            });

            // Calculate Actual cumulative (items completed or ready by each month based on today's progress)
            const today = new Date();
            const actualCumulative = months.map(month => {
                // For past months, show actual progress
                // For future months, show projected based on current rate
                if (month <= today) {
                    const completedOrReady = level5Items.filter(item => {
                        const planDate = parseDateString(item.planStart);
                        if (!planDate || planDate > month) return false;
                        const status = getEffectiveStatus(item).status;
                        return status === 'completed' || status === 'ready-to-start';
                    }).length;
                    return Math.round((completedOrReady / totalItems) * 100);
                }
                return null; // Future months - no actual data
            });

            // Calculate deviation
            const deviation = months.map((month, i) => {
                if (actualCumulative[i] === null) return null;
                return actualCumulative[i] - planCumulative[i];
            });

            // Format labels
            const labels = months.map(m => `${monthNames[m.getMonth()]} ${m.getFullYear()}`);

            dashboardCharts.scurve = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Plan (Cumulative %)',
                        data: planCumulative,
                        borderColor: 'rgba(45, 156, 219, 1)',
                        backgroundColor: 'rgba(45, 156, 219, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.3,
                        pointRadius: 4,
                        pointBackgroundColor: 'rgba(45, 156, 219, 1)'
                    }, {
                        label: 'Actual (Cumulative %)',
                        data: actualCumulative,
                        borderColor: 'rgba(39, 174, 96, 1)',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.3,
                        pointRadius: 4,
                        pointBackgroundColor: 'rgba(39, 174, 96, 1)'
                    }, {
                        label: 'Deviation (%)',
                        data: deviation,
                        borderColor: 'rgba(235, 87, 87, 0.8)',
                        backgroundColor: 'rgba(235, 87, 87, 0.3)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: true,
                        tension: 0.3,
                        pointRadius: 3,
                        pointBackgroundColor: 'rgba(235, 87, 87, 1)',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: { 
                            grid: { color: 'rgba(255,255,255,0.05)' }, 
                            ticks: { 
                                color: '#8fa3bf',
                                font: { size: 9 },
                                maxRotation: 45,
                                minRotation: 45
                            },
                            title: {
                                display: true,
                                text: 'Timeline (Month Year)',
                                color: '#8fa3bf',
                                font: { size: 10, weight: '600' }
                            }
                        },
                        y: { 
                            type: 'linear',
                            position: 'left',
                            min: 0,
                            max: 100,
                            grid: { color: 'rgba(255,255,255,0.05)' }, 
                            ticks: { 
                                color: '#8fa3bf',
                                callback: value => value + '%'
                            },
                            title: {
                                display: true,
                                text: 'Cumulative Progress (%)',
                                color: '#8fa3bf',
                                font: { size: 10, weight: '600' }
                            }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            min: -50,
                            max: 50,
                            grid: { display: false },
                            ticks: { 
                                color: '#eb5757',
                                callback: value => value + '%'
                            },
                            title: {
                                display: true,
                                text: 'Deviation (%)',
                                color: '#eb5757',
                                font: { size: 10, weight: '600' }
                            }
                        }
                    },
                    plugins: {
                        legend: { 
                            position: 'top', 
                            labels: { 
                                color: '#8fa3bf', 
                                font: { size: 10 }, 
                                usePointStyle: true,
                                padding: 15
                            } 
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (context.parsed.y !== null) {
                                        label += ': ' + context.parsed.y + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderAreaBreakdown() {
            const container = document.getElementById('areaBreakdown');
            if (!container) return;

            const areas = {};
            workItems.filter(i => i.level === 5).forEach(item => {
                const area = getArea(item, workItems);
                if (!areas[area.description]) {
                    areas[area.description] = { total: 0, ready: 0, critical: 0 };
                }
                areas[area.description].total++;
                const status = getEffectiveStatus(item).status;
                if (status === 'ready-to-start' || status === 'completed') areas[area.description].ready++;
                if (status !== 'completed' && status !== 'ready-to-start') {
                    const risk = calculateLevel5Risk(item);
                    if (risk.level === 'critical') areas[area.description].critical++;
                }
            });

            container.innerHTML = Object.entries(areas)
                .sort((a, b) => b[1].total - a[1].total)
                .map(([name, stats]) => `
                    <div class="area-item">
                        <div class="area-name" title="${name}">${name}</div>
                        <div class="area-stats">
                            <span class="area-stat total">${stats.total}</span>
                            <span class="area-stat ready">${stats.ready} âœ“</span>
                            ${stats.critical > 0 ? `<span class="area-stat critical">${stats.critical} !</span>` : ''}
                        </div>
                    </div>
                `).join('');
        }

        function renderTopRankList() {
            const container = document.getElementById('topRankList');
            if (!container) return;

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const criticalItems = workItems.filter(i => {
                if (i.level !== 5) return false;
                const status = getEffectiveStatus(i).status;
                if (status === 'completed' || status === 'ready-to-start') return false;
                const risk = calculateLevel5Risk(i);
                return risk.level === 'critical' || risk.level === 'high';
            }).map(item => {
                const risk = calculateLevel5Risk(item);
                const area = getArea(item, workItems);
                const discipline = getDiscipline(item, workItems);
                const score = calculateLevel5Score(item);
                
                // Calculate days until plan start
                let daysUntil = 999;
                if (item.planStart) {
                    const planDate = new Date(item.planStart);
                    daysUntil = Math.ceil((planDate - today) / (1000 * 60 * 60 * 24));
                }
                
                // Calculate urgency score (lower is more urgent)
                // Priority: 1. Risk level (critical=0, high=100), 2. Days until start, 3. Resource score (lower=worse)
                const riskScore = risk.level === 'critical' ? 0 : 100;
                const urgencyScore = riskScore + daysUntil + (100 - score);
                
                return { ...item, risk, area, discipline, score, daysUntil, urgencyScore };
            }).sort((a, b) => a.urgencyScore - b.urgencyScore);

            if (criticalItems.length === 0) {
                container.innerHTML = '<div style="padding: 30px; text-align: center; color: var(--text-secondary);">ðŸŽ‰ Tidak ada item critical atau high risk!</div>';
                return;
            }

            const top10 = criticalItems.slice(0, 10);
            
            container.innerHTML = top10.map((item, index) => {
                const rank = index + 1;
                let rankClass = 'normal';
                if (rank === 1) rankClass = 'gold';
                else if (rank === 2) rankClass = 'silver';
                else if (rank === 3) rankClass = 'bronze';
                
                let daysClass = 'warning';
                let daysText = `${item.daysUntil} days`;
                if (item.daysUntil < 0) {
                    daysClass = 'overdue';
                    daysText = `${Math.abs(item.daysUntil)}d overdue`;
                } else if (item.daysUntil <= 7) {
                    daysClass = 'urgent';
                    daysText = `${item.daysUntil}d left`;
                } else if (item.daysUntil <= 14) {
                    daysClass = 'warning';
                    daysText = `${item.daysUntil}d left`;
                }
                
                return `
                    <div class="top-rank-item">
                        <div class="rank-number ${rankClass}">${rank}</div>
                        <div class="wbs">${item.wbs}</div>
                        <div>
                            <div class="desc">${item.description.substring(0, 45)}${item.description.length > 45 ? '...' : ''}</div>
                            <div class="area-disc">${item.area.description.substring(0, 20)} â†’ ${item.discipline.description.substring(0, 20)}</div>
                        </div>
                        <div class="date">${formatDate(item.planStart)}</div>
                        <div class="score-mini" style="color: ${item.score < 50 ? 'var(--accent-red)' : item.score < 80 ? 'var(--accent-yellow)' : 'var(--accent-green)'};">${item.score}%</div>
                        <div class="days-left ${daysClass}">${daysText}</div>
                        <div><span class="risk-badge ${item.risk.color}" style="font-size:9px;padding:3px 8px;">${item.risk.label}</span></div>
                    </div>
                `;
            }).join('');
        }

        function renderCriticalList() {
            const container = document.getElementById('criticalList');
            if (!container) return;

            const criticalItems = workItems.filter(i => {
                if (i.level !== 5) return false;
                const status = getEffectiveStatus(i).status;
                if (status === 'completed' || status === 'ready-to-start') return false;
                const risk = calculateLevel5Risk(i);
                return risk.level === 'critical' || risk.level === 'high';
            }).map(item => {
                const risk = calculateLevel5Risk(item);
                const area = getArea(item, workItems);
                const discipline = getDiscipline(item, workItems);
                return { ...item, risk, area, discipline };
            }).sort((a, b) => {
                const order = { critical: 0, high: 1 };
                return (order[a.risk.level] || 2) - (order[b.risk.level] || 2);
            });

            if (criticalItems.length === 0) {
                container.innerHTML = '<div style="padding: 30px; text-align: center; color: var(--text-secondary);">ðŸŽ‰ Tidak ada item critical atau high risk!</div>';
                return;
            }

            container.innerHTML = criticalItems.slice(0, 50).map(item => {
                const daysText = item.risk.factors.match(/(\d+) hari/)?.[0] || '-';
                return `
                    <div class="critical-item">
                        <div class="wbs">${item.wbs}</div>
                        <div>
                            <div class="desc">${item.description.substring(0, 40)}${item.description.length > 40 ? '...' : ''}</div>
                            <div class="area-disc">${item.area.description.substring(0, 25)} â†’ ${item.discipline.description.substring(0, 25)}</div>
                        </div>
                        <div class="date">${formatDate(item.planStart)}</div>
                        <div class="days-badge">${daysText}</div>
                        <div><span class="risk-badge ${item.risk.color}" style="font-size:9px;padding:3px 8px;">${item.risk.label}</span></div>
                    </div>
                `;
            }).join('');
        }

        function closeSummaryModal() { document.getElementById('summaryModal').classList.remove('show'); }

        // ========================================
        // PDF EXPORT FUNCTIONS
        // ========================================
        
        const { jsPDF } = window.jspdf;
        
        // Helper function to sanitize text for PDF (fix encoding issues)
        function sanitizeText(text) {
            if (!text) return '-';
            return String(text)
                .replace(/[^\x20-\x7E\u00A0-\u00FF]/g, '') // Remove non-printable chars
                .replace(/&/g, '&')
                .trim() || '-';
        }
        
        // PDF Helper Functions - Light Theme
        function createPDFHeader(pdf, title, subtitle) {
            const pageWidth = pdf.internal.pageSize.getWidth();
            
            // Header background - dark blue
            pdf.setFillColor(44, 62, 80);
            pdf.rect(0, 0, pageWidth, 28, 'F');
            
            // Orange accent line
            pdf.setFillColor(255, 107, 44);
            pdf.rect(0, 28, pageWidth, 2, 'F');
            
            // Title - white
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(16);
            pdf.setFont('helvetica', 'bold');
            pdf.text(sanitizeText(title), 15, 12);
            
            // Subtitle
            pdf.setFontSize(9);
            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(200, 200, 200);
            pdf.text(sanitizeText(subtitle), 15, 20);
            
            // Date
            const dateStr = new Date().toLocaleDateString('id-ID', { 
                year: 'numeric', month: 'long', day: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
            pdf.text('Generated: ' + dateStr, pageWidth - 15, 20, { align: 'right' });
            
            return 38; // Return Y position after header
        }
        
        function addPDFFooter(pdf, pageNum, totalPages, reportTitle) {
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            
            // Footer line
            pdf.setDrawColor(200, 200, 200);
            pdf.line(15, pageHeight - 12, pageWidth - 15, pageHeight - 12);
            
            pdf.setFontSize(8);
            pdf.setTextColor(100, 100, 100);
            pdf.text(reportTitle || 'Work Item Monitoring System', 15, pageHeight - 6);
            pdf.text('Page ' + pageNum + ' of ' + totalPages, pageWidth - 15, pageHeight - 6, { align: 'right' });
        }
        
        function addSectionTitle(pdf, title, y) {
            const pageWidth = pdf.internal.pageSize.getWidth();
            
            // Section background
            pdf.setFillColor(236, 240, 241);
            pdf.roundedRect(15, y - 4, pageWidth - 30, 10, 2, 2, 'F');
            
            // Left accent
            pdf.setFillColor(255, 107, 44);
            pdf.rect(15, y - 4, 3, 10, 'F');
            
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(44, 62, 80);
            pdf.text(sanitizeText(title), 22, y + 3);
            
            return y + 12;
        }
        
        async function captureChartAsImage(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return null;
            try {
                return canvas.toDataURL('image/png', 1.0);
            } catch(e) {
                return null;
            }
        }
        
        function checkPageBreak(pdf, currentY, neededHeight, marginBottom = 20) {
            const pageHeight = pdf.internal.pageSize.getHeight();
            if (currentY + neededHeight > pageHeight - marginBottom) {
                pdf.addPage();
                return 15;
            }
            return currentY;
        }
        
        // Dashboard PDF Export - Landscape, Light Theme
        async function exportDashboardPDF() {
            showToast('Generating Dashboard PDF...', 'info');
            
            try {
                const pdf = new jsPDF('l', 'mm', 'a4'); // Landscape
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 15;
                const contentWidth = pageWidth - (margin * 2);
                
                // White background
                pdf.setFillColor(255, 255, 255);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                
                let currentY = createPDFHeader(pdf, 'Dashboard Analytics Report', 'Work Item Monitoring System');
                
                const stats = calculateDashboardStats();
                
                // Summary Statistics Section
                currentY = addSectionTitle(pdf, 'Summary Statistics', currentY);
                
                // Stats boxes
                const statsData = [
                    { label: 'Total Level 5', value: stats.totalLevel5, color: [52, 152, 219] },
                    { label: 'Ready to Start', value: stats.readyToStart, color: [46, 204, 113] },
                    { label: 'Need Check', value: stats.needCheck, color: [243, 156, 18] },
                    { label: 'Critical', value: stats.critical, color: [231, 76, 60] }
                ];
                
                const boxWidth = (contentWidth - 15) / 4;
                statsData.forEach((stat, i) => {
                    const x = margin + (i * (boxWidth + 5));
                    
                    // Box shadow effect
                    pdf.setFillColor(230, 230, 230);
                    pdf.roundedRect(x + 1, currentY + 1, boxWidth, 22, 3, 3, 'F');
                    
                    // Main box
                    pdf.setFillColor(...stat.color);
                    pdf.roundedRect(x, currentY, boxWidth, 22, 3, 3, 'F');
                    
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(18);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(String(stat.value), x + boxWidth/2, currentY + 11, { align: 'center' });
                    pdf.setFontSize(8);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(stat.label, x + boxWidth/2, currentY + 18, { align: 'center' });
                });
                
                currentY += 32;
                
                // Capture and add charts - 3 per row
                const charts = [
                    { id: 'statusChart', title: 'Status Distribution' },
                    { id: 'riskChart', title: 'Risk Level Distribution' },
                    { id: 'areaChart', title: 'Items by Area' },
                    { id: 'disciplineChart', title: 'Items by Discipline' },
                    { id: 'resourceChart', title: 'Resource Readiness' },
                    { id: 'scurveChart', title: 'S-Curve Progress' }
                ];
                
                const chartWidth = (contentWidth - 10) / 3;
                const chartHeight = 55;
                
                for (let i = 0; i < charts.length; i += 3) {
                    currentY = checkPageBreak(pdf, currentY, chartHeight + 15);
                    
                    // Add white background for new page
                    if (currentY === 15) {
                        pdf.setFillColor(255, 255, 255);
                        pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                    }
                    
                    for (let j = 0; j < 3 && (i + j) < charts.length; j++) {
                        const chart = charts[i + j];
                        const imgData = await captureChartAsImage(chart.id);
                        const x = margin + (j * (chartWidth + 5));
                        
                        // Chart container - darker background for better visibility
                        pdf.setFillColor(45, 55, 72);
                        pdf.setDrawColor(60, 70, 90);
                        pdf.roundedRect(x, currentY, chartWidth, chartHeight + 10, 3, 3, 'FD');
                        
                        // Chart title - white text on dark background
                        pdf.setFontSize(9);
                        pdf.setFont('helvetica', 'bold');
                        pdf.setTextColor(255, 255, 255);
                        pdf.text(chart.title, x + 5, currentY + 7);
                        
                        if (imgData) {
                            pdf.addImage(imgData, 'PNG', x + 3, currentY + 10, chartWidth - 6, chartHeight - 5);
                        }
                    }
                    currentY += chartHeight + 18;
                }
                
                // Area Breakdown Table
                currentY = checkPageBreak(pdf, currentY, 60);
                if (currentY === 15) {
                    pdf.setFillColor(255, 255, 255);
                    pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                }
                
                currentY = addSectionTitle(pdf, 'Area Breakdown Summary', currentY);
                
                const areas = {};
                workItems.filter(i => i.level === 5).forEach(item => {
                    const area = getArea(item, workItems);
                    const areaName = sanitizeText(area.description);
                    if (!areas[areaName]) areas[areaName] = { total: 0, ready: 0, critical: 0 };
                    areas[areaName].total++;
                    const status = getEffectiveStatus(item).status;
                    if (status === 'ready-to-start' || status === 'completed') areas[areaName].ready++;
                    if (status !== 'completed' && status !== 'ready-to-start') {
                        const risk = calculateLevel5Risk(item);
                        if (risk.level === 'critical') areas[areaName].critical++;
                    }
                });
                
                // Table header
                pdf.setFillColor(44, 62, 80);
                pdf.rect(margin, currentY, contentWidth, 8, 'F');
                pdf.setFontSize(8);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(255, 255, 255);
                pdf.text('Area', margin + 5, currentY + 5.5);
                pdf.text('Total', margin + 150, currentY + 5.5);
                pdf.text('Ready', margin + 175, currentY + 5.5);
                pdf.text('Critical', margin + 200, currentY + 5.5);
                currentY += 8;
                
                const sortedAreas = Object.entries(areas).sort((a, b) => b[1].total - a[1].total);
                
                sortedAreas.slice(0, 15).forEach(([name, data], idx) => {
                    currentY = checkPageBreak(pdf, currentY, 7);
                    
                    // Alternating row colors
                    pdf.setFillColor(idx % 2 === 0 ? 250 : 240, idx % 2 === 0 ? 250 : 240, idx % 2 === 0 ? 250 : 245);
                    pdf.rect(margin, currentY, contentWidth, 6, 'F');
                    
                    pdf.setFontSize(8);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(50, 50, 50);
                    pdf.text(name.substring(0, 60), margin + 5, currentY + 4);
                    pdf.text(String(data.total), margin + 150, currentY + 4);
                    
                    pdf.setTextColor(46, 204, 113);
                    pdf.text(String(data.ready), margin + 175, currentY + 4);
                    
                    pdf.setTextColor(231, 76, 60);
                    pdf.text(String(data.critical), margin + 200, currentY + 4);
                    
                    currentY += 6;
                });
                
                // Top 10 Risk Register Section
                currentY = checkPageBreak(pdf, currentY, 80);
                if (currentY === 15) {
                    pdf.setFillColor(255, 255, 255);
                    pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                }
                
                currentY = addSectionTitle(pdf, 'Top 10 Critical & High Risk Items', currentY);
                
                // Get top 10 risk items
                const riskStats = calculateRiskStats();
                const top10Items = riskStats.riskItems
                    .filter(i => i.risk.level === 'critical' || i.risk.level === 'high')
                    .slice(0, 10);
                
                if (top10Items.length > 0) {
                    // Table header
                    const riskColWidths = [8, 25, 60, 45, 25, 20, 20, 50];
                    const riskColX = [margin];
                    for (let i = 1; i < riskColWidths.length; i++) {
                        riskColX.push(riskColX[i-1] + riskColWidths[i-1]);
                    }
                    
                    pdf.setFillColor(44, 62, 80);
                    pdf.rect(margin, currentY, contentWidth, 7, 'F');
                    pdf.setFontSize(7);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(255, 255, 255);
                    
                    const riskHeaders = ['Rank', 'WBS', 'Description', 'Area', 'Plan Start', 'Risk', 'Score', 'Risk Factors'];
                    riskHeaders.forEach((h, i) => pdf.text(h, riskColX[i] + 2, currentY + 5));
                    currentY += 7;
                    
                    // Table rows
                    pdf.setFont('helvetica', 'normal');
                    top10Items.forEach((item, idx) => {
                        // Alternating rows
                        pdf.setFillColor(idx % 2 === 0 ? 252 : 245, idx % 2 === 0 ? 252 : 245, idx % 2 === 0 ? 252 : 248);
                        pdf.rect(margin, currentY, contentWidth, 6, 'F');
                        
                        pdf.setFontSize(7);
                        
                        // Rank with medal colors
                        if (idx === 0) pdf.setTextColor(255, 215, 0); // Gold
                        else if (idx === 1) pdf.setTextColor(192, 192, 192); // Silver
                        else if (idx === 2) pdf.setTextColor(205, 127, 50); // Bronze
                        else pdf.setTextColor(100, 100, 100);
                        pdf.setFont('helvetica', 'bold');
                        pdf.text('#' + (idx + 1), riskColX[0] + 2, currentY + 4.5);
                        
                        // WBS
                        pdf.setFont('helvetica', 'normal');
                        pdf.setTextColor(52, 152, 219);
                        pdf.text(sanitizeText(item.wbs).substring(0, 14), riskColX[1] + 2, currentY + 4.5);
                        
                        // Description
                        pdf.setTextColor(50, 50, 50);
                        pdf.text(sanitizeText(item.description).substring(0, 32), riskColX[2] + 2, currentY + 4.5);
                        
                        // Area
                        pdf.text(sanitizeText(item.area.description).substring(0, 22), riskColX[3] + 2, currentY + 4.5);
                        
                        // Plan Start
                        pdf.text(sanitizeText(formatDate(item.planStart)).substring(0, 12), riskColX[4] + 2, currentY + 4.5);
                        
                        // Risk Level
                        const riskColors = { 
                            critical: [192, 57, 43], 
                            high: [231, 76, 60], 
                            medium: [243, 156, 18], 
                            low: [46, 204, 113] 
                        };
                        pdf.setTextColor(...(riskColors[item.risk.level] || [100, 100, 100]));
                        pdf.setFont('helvetica', 'bold');
                        pdf.text(item.risk.label, riskColX[5] + 2, currentY + 4.5);
                        
                        // Score
                        pdf.setFont('helvetica', 'normal');
                        pdf.setTextColor(50, 50, 50);
                        pdf.text(item.score + '%', riskColX[6] + 2, currentY + 4.5);
                        
                        // Risk Factors
                        const factors = sanitizeText(item.risk.factors || 'N/A');
                        pdf.text(factors.substring(0, 28), riskColX[7] + 2, currentY + 4.5);
                        
                        currentY += 6;
                    });
                } else {
                    pdf.setFontSize(9);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Tidak ada item dengan risk Critical atau High', margin + 5, currentY + 10);
                    currentY += 15;
                }
                
                // Add page numbers
                const totalPages = pdf.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    pdf.setPage(i);
                    addPDFFooter(pdf, i, totalPages, 'Dashboard Analytics Report');
                }
                
                pdf.save('Dashboard_Report_' + new Date().toISOString().slice(0,10) + '.pdf');
                showToast('Dashboard PDF berhasil di-export!', 'success');
                
            } catch (error) {
                console.error('PDF Export Error:', error);
                showToast('Gagal export PDF: ' + error.message, 'error');
            }
        }
        
        // Risk Analysis PDF Export - Landscape, Light Theme
        async function exportRiskAnalysisPDF() {
            showToast('Generating Risk Analysis PDF...', 'info');
            
            try {
                const pdf = new jsPDF('l', 'mm', 'a4'); // Landscape
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 15;
                const contentWidth = pageWidth - (margin * 2);
                
                // White background
                pdf.setFillColor(255, 255, 255);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                
                let currentY = createPDFHeader(pdf, 'Risk Analysis Report', 'Risk Register & Trend Analysis');
                
                const stats = calculateRiskStats();
                
                // Risk Summary Section
                currentY = addSectionTitle(pdf, 'Risk Summary', currentY);
                
                const riskStats = [
                    { label: 'Total At Risk', value: stats.total, color: [52, 152, 219] },
                    { label: 'Critical', value: stats.critical, color: [192, 57, 43] },
                    { label: 'High', value: stats.high, color: [231, 76, 60] },
                    { label: 'Medium', value: stats.medium, color: [243, 156, 18] },
                    { label: 'Low', value: stats.low, color: [46, 204, 113] }
                ];
                
                const boxWidth = (contentWidth - 20) / 5;
                riskStats.forEach((stat, i) => {
                    const x = margin + (i * (boxWidth + 5));
                    
                    pdf.setFillColor(230, 230, 230);
                    pdf.roundedRect(x + 1, currentY + 1, boxWidth, 20, 3, 3, 'F');
                    
                    pdf.setFillColor(...stat.color);
                    pdf.roundedRect(x, currentY, boxWidth, 20, 3, 3, 'F');
                    
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(16);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(String(stat.value), x + boxWidth/2, currentY + 10, { align: 'center' });
                    pdf.setFontSize(7);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(stat.label, x + boxWidth/2, currentY + 16, { align: 'center' });
                });
                
                currentY += 30;
                
                // Capture Charts - 3 per row
                const riskChartIds = [
                    { id: 'riskDistChart', title: 'Risk Distribution' },
                    { id: 'riskByAreaChart', title: 'Risk by Area' },
                    { id: 'riskTrendChart', title: 'Risk Score Trend' }
                ];
                
                const chartWidth = (contentWidth - 10) / 3;
                const chartHeight = 55;
                
                for (let j = 0; j < riskChartIds.length; j++) {
                    const chart = riskChartIds[j];
                    const imgData = await captureChartAsImage(chart.id);
                    const x = margin + (j * (chartWidth + 5));
                    
                    // Chart container - darker background for better visibility
                    pdf.setFillColor(45, 55, 72);
                    pdf.setDrawColor(60, 70, 90);
                    pdf.roundedRect(x, currentY, chartWidth, chartHeight + 10, 3, 3, 'FD');
                    
                    // Chart title - white text on dark background
                    pdf.setFontSize(9);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(255, 255, 255);
                    pdf.text(chart.title, x + 5, currentY + 7);
                    
                    if (imgData) {
                        pdf.addImage(imgData, 'PNG', x + 3, currentY + 10, chartWidth - 6, chartHeight - 5);
                    }
                }
                currentY += chartHeight + 18;
                
                // Risk Register Table - ALL ITEMS
                pdf.addPage();
                pdf.setFillColor(255, 255, 255);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                
                currentY = 15;
                const totalRiskItems = stats.riskItems.length;
                currentY = addSectionTitle(pdf, 'Complete Risk Register (' + totalRiskItems + ' Items)', currentY);
                
                // Table header - with Discipline column
                const colWidths = [20, 24, 50, 38, 38, 24, 18, 40];
                const colX = [margin];
                for (let i = 1; i < colWidths.length; i++) {
                    colX.push(colX[i-1] + colWidths[i-1]);
                }
                
                // Function to draw risk table header
                function drawRiskTableHeader(y) {
                    pdf.setFillColor(44, 62, 80);
                    pdf.rect(margin, y, contentWidth, 7, 'F');
                    pdf.setFontSize(6.5);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(255, 255, 255);
                    
                    const headers = ['Risk ID', 'WBS', 'Description', 'Area', 'Discipline', 'Risk Level', 'Score', 'Risk Factors'];
                    headers.forEach((h, i) => {
                        pdf.text(h, colX[i] + 1, y + 5);
                    });
                    return y + 7;
                }
                
                currentY = drawRiskTableHeader(currentY);
                
                // ALL risk items (no slice limit)
                pdf.setFont('helvetica', 'normal');
                stats.riskItems.forEach((item, idx) => {
                    // Check page break
                    if (currentY > pageHeight - 18) {
                        pdf.addPage();
                        pdf.setFillColor(255, 255, 255);
                        pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                        currentY = 12;
                        currentY = drawRiskTableHeader(currentY);
                    }
                    
                    // Alternating rows
                    pdf.setFillColor(idx % 2 === 0 ? 252 : 245, idx % 2 === 0 ? 252 : 245, idx % 2 === 0 ? 252 : 248);
                    pdf.rect(margin, currentY, contentWidth, 5, 'F');
                    
                    pdf.setFontSize(5.5);
                    
                    // Risk ID
                    pdf.setTextColor(52, 152, 219);
                    pdf.text('RSK-' + String(idx + 1).padStart(4, '0'), colX[0] + 1, currentY + 3.5);
                    
                    // WBS
                    pdf.setTextColor(44, 62, 80);
                    pdf.text(sanitizeText(item.wbs).substring(0, 14), colX[1] + 1, currentY + 3.5);
                    
                    // Description
                    pdf.setTextColor(50, 50, 50);
                    pdf.text(sanitizeText(item.description).substring(0, 28), colX[2] + 1, currentY + 3.5);
                    
                    // Area
                    pdf.text(sanitizeText(item.area.description).substring(0, 20), colX[3] + 1, currentY + 3.5);
                    
                    // Discipline
                    pdf.text(sanitizeText(item.discipline.description).substring(0, 20), colX[4] + 1, currentY + 3.5);
                    
                    // Risk level color
                    const riskColors = { 
                        critical: [192, 57, 43], 
                        high: [231, 76, 60], 
                        medium: [243, 156, 18], 
                        low: [46, 204, 113] 
                    };
                    pdf.setTextColor(...(riskColors[item.risk.level] || [100, 100, 100]));
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(item.risk.label, colX[5] + 1, currentY + 3.5);
                    
                    // Score
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(50, 50, 50);
                    pdf.text(item.score + '%', colX[6] + 1, currentY + 3.5);
                    
                    // Factors
                    const factors = sanitizeText(item.risk.factors || 'N/A');
                    pdf.text(factors.substring(0, 22), colX[7] + 1, currentY + 3.5);
                    
                    currentY += 5;
                });
                
                // Add page numbers
                const totalPages = pdf.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    pdf.setPage(i);
                    addPDFFooter(pdf, i, totalPages, 'Risk Analysis Report');
                }
                
                pdf.save('Risk_Analysis_Report_' + new Date().toISOString().slice(0,10) + '.pdf');
                showToast('Risk Analysis PDF berhasil di-export!', 'success');
                
            } catch (error) {
                console.error('PDF Export Error:', error);
                showToast('Gagal export PDF: ' + error.message, 'error');
            }
        }
        
        // Summary PDF Export - Landscape, Light Theme
        async function exportSummaryPDF() {
            showToast('Generating Summary PDF...', 'info');
            
            try {
                const pdf = new jsPDF('l', 'mm', 'a4'); // Landscape
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 12; // Increased margin
                const contentWidth = pageWidth - (margin * 2);
                
                // White background
                pdf.setFillColor(255, 255, 255);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                
                // Header
                pdf.setFillColor(44, 62, 80);
                pdf.rect(0, 0, pageWidth, 22, 'F');
                pdf.setFillColor(255, 107, 44);
                pdf.rect(0, 22, pageWidth, 2, 'F');
                
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.text('Resource Readiness Summary - Level 5 Items', margin, 10);
                
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(200, 200, 200);
                const dateStr = new Date().toLocaleDateString('id-ID', { 
                    year: 'numeric', month: 'long', day: 'numeric'
                });
                pdf.text('Generated: ' + dateStr, pageWidth - margin, 10, { align: 'right' });
                
                let currentY = 30;
                
                // Summary stats
                const level5Items = workItems.filter(i => i.level === 5);
                const completed = level5Items.filter(i => getEffectiveStatus(i).status === 'completed').length;
                const ready = level5Items.filter(i => getEffectiveStatus(i).status === 'ready-to-start').length;
                const pending = level5Items.filter(i => {
                    const s = getEffectiveStatus(i).status;
                    return s !== 'completed' && s !== 'ready-to-start';
                });
                const critical = pending.filter(i => calculateLevel5Risk(i).level === 'critical').length;
                const high = pending.filter(i => calculateLevel5Risk(i).level === 'high').length;
                
                const summaryStats = [
                    { label: 'Total Level 5', value: level5Items.length, color: [52, 152, 219] },
                    { label: 'Completed', value: completed, color: [46, 204, 113] },
                    { label: 'Ready to Start', value: ready, color: [26, 188, 156] },
                    { label: 'Critical', value: critical, color: [192, 57, 43] },
                    { label: 'High Risk', value: high, color: [231, 76, 60] }
                ];
                
                const statBoxWidth = (contentWidth - 20) / 5;
                summaryStats.forEach((stat, i) => {
                    const x = margin + (i * (statBoxWidth + 5));
                    
                    pdf.setFillColor(230, 230, 230);
                    pdf.roundedRect(x + 1, currentY + 1, statBoxWidth, 16, 2, 2, 'F');
                    
                    pdf.setFillColor(...stat.color);
                    pdf.roundedRect(x, currentY, statBoxWidth, 16, 2, 2, 'F');
                    
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(14);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(String(stat.value), x + statBoxWidth/2, currentY + 8, { align: 'center' });
                    pdf.setFontSize(6);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(stat.label, x + statBoxWidth/2, currentY + 13, { align: 'center' });
                });
                
                currentY += 24;
                
                // Table columns - adjusted widths for proper fit with margins
                // A4 Landscape = 297mm width, margin 12mm each side = 273mm content
                const cols = [
                    { label: 'WBS', width: 22 },
                    { label: 'Description', width: 45 },
                    { label: 'Area', width: 35 },
                    { label: 'Discipline', width: 35 },
                    { label: 'Plan Start', width: 20 },
                    { label: 'Status', width: 20 },
                    { label: 'Score', width: 12 },
                    { label: 'Risk', width: 14 },
                    { label: 'Eng', width: 11 },
                    { label: 'Mat', width: 11 },
                    { label: 'WF', width: 11 },
                    { label: 'Front', width: 11 },
                    { label: 'Equip', width: 11 },
                    { label: 'Tools', width: 11 }
                ];
                
                // Calculate total width and X positions
                const totalColWidth = cols.reduce((sum, col) => sum + col.width, 0);
                const tableWidth = Math.min(totalColWidth, contentWidth);
                const startX = margin;
                
                let xPos = startX;
                cols.forEach(col => {
                    col.x = xPos;
                    xPos += col.width;
                });
                
                // Function to draw table header
                function drawTableHeader(y) {
                    pdf.setFillColor(44, 62, 80);
                    pdf.rect(startX, y, tableWidth, 7, 'F');
                    pdf.setFontSize(5.5);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(255, 255, 255);
                    cols.forEach(col => pdf.text(col.label, col.x + 1, y + 5));
                    return y + 7;
                }
                
                currentY = drawTableHeader(currentY);
                
                // Table rows
                pdf.setFont('helvetica', 'normal');
                level5Items.forEach((item, idx) => {
                    if (currentY > pageHeight - 18) {
                        pdf.addPage();
                        pdf.setFillColor(255, 255, 255);
                        pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                        currentY = 12;
                        currentY = drawTableHeader(currentY);
                    }
                    
                    // Alternating rows
                    pdf.setFillColor(idx % 2 === 0 ? 252 : 245, idx % 2 === 0 ? 252 : 245, idx % 2 === 0 ? 252 : 248);
                    pdf.rect(startX, currentY, tableWidth, 5, 'F');
                    
                    const effectiveStatus = getEffectiveStatus(item);
                    const score = calculateLevel5Score(item);
                    const risk = calculateLevel5Risk(item);
                    const area = getArea(item, workItems);
                    const discipline = getDiscipline(item, workItems);
                    const isComplete = effectiveStatus.status === 'completed';
                    const isReady = effectiveStatus.status === 'ready-to-start';
                    
                    pdf.setFontSize(5);
                    
                    // WBS
                    pdf.setTextColor(52, 152, 219);
                    pdf.text(sanitizeText(item.wbs).substring(0, 14), cols[0].x + 1, currentY + 3.5);
                    
                    // Description
                    pdf.setTextColor(50, 50, 50);
                    pdf.text(sanitizeText(item.description).substring(0, 26), cols[1].x + 1, currentY + 3.5);
                    
                    // Area
                    pdf.text(sanitizeText(area.description).substring(0, 18), cols[2].x + 1, currentY + 3.5);
                    
                    // Discipline
                    pdf.text(sanitizeText(discipline.description).substring(0, 18), cols[3].x + 1, currentY + 3.5);
                    
                    // Plan Start
                    pdf.text(sanitizeText(formatDate(item.planStart)).substring(0, 11), cols[4].x + 1, currentY + 3.5);
                    
                    // Status color
                    const statusColors = {
                        'completed': [46, 204, 113],
                        'ready-to-start': [26, 188, 156],
                        'overdue': [231, 76, 60],
                        'not-started': [155, 89, 182]
                    };
                    pdf.setTextColor(...(statusColors[effectiveStatus.status] || [100, 100, 100]));
                    
                    let statusText = effectiveStatus.status;
                    if (statusText === 'ready-to-start') statusText = 'Ready';
                    else if (statusText === 'not-started') statusText = 'Not Started';
                    else statusText = statusText.charAt(0).toUpperCase() + statusText.slice(1);
                    pdf.text(statusText.substring(0, 12), cols[5].x + 1, currentY + 3.5);
                    
                    // Score
                    pdf.setTextColor(50, 50, 50);
                    pdf.text(score + '%', cols[6].x + 1, currentY + 3.5);
                    
                    // Risk
                    const riskColors = { 
                        critical: [192, 57, 43], 
                        high: [231, 76, 60], 
                        medium: [243, 156, 18], 
                        low: [46, 204, 113] 
                    };
                    pdf.setTextColor(...(riskColors[risk.level] || [100, 100, 100]));
                    pdf.text(risk.label, cols[7].x + 1, currentY + 3.5);
                    
                    // Resource status symbols
                    resourceTypes.forEach((r, ri) => {
                        const colIdx = 8 + ri;
                        if (isComplete || isReady) {
                            pdf.setTextColor(46, 204, 113);
                            pdf.text('OK', cols[colIdx].x + 2, currentY + 3.5);
                        } else {
                            const status = item.resources[r].status;
                            if (status === 'ready') {
                                pdf.setTextColor(46, 204, 113);
                                pdf.text('OK', cols[colIdx].x + 2, currentY + 3.5);
                            } else if (status === 'pending') {
                                pdf.setTextColor(243, 156, 18);
                                pdf.text('PND', cols[colIdx].x + 1, currentY + 3.5);
                            } else {
                                pdf.setTextColor(231, 76, 60);
                                pdf.text('NO', cols[colIdx].x + 2, currentY + 3.5);
                            }
                        }
                    });
                    
                    currentY += 5;
                });
                
                // Add page numbers
                const totalPages = pdf.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    pdf.setPage(i);
                    addPDFFooter(pdf, i, totalPages, 'Resource Readiness Summary');
                }
                
                pdf.save('Resource_Summary_Report_' + new Date().toISOString().slice(0,10) + '.pdf');
                showToast('Summary PDF berhasil di-export!', 'success');
                
            } catch (error) {
                console.error('PDF Export Error:', error);
                showToast('Gagal export PDF: ' + error.message, 'error');
            }
        }
        function exportData() {
            if (!workItems.length) return showToast('Tidak ada data', 'error');
            const headers = ['Level', 'WBS', 'Description', 'Area', 'Discipline', 'Plan_Start', 'Original_Status', 'Current_Status', 'Score', 'Risk_Level', ...resourceTypes.flatMap(r => [`${r}_Status`, `${r}_Desc`, `${r}_Date`])];
            const rows = workItems.map(item => {
                const d = getItemDisplayData(item, workItems);
                const area = getArea(item, workItems);
                const discipline = getDiscipline(item, workItems);
                const isLevel5 = item.level === 5;
                return [item.level, item.wbs, `"${item.description.replace(/"/g, '""')}"`, `"${area.description.replace(/"/g, '""')}"`, `"${discipline.description.replace(/"/g, '""')}"`, item.planStart || '', item.originalStatus || item.status, d.status, d.score !== null ? d.score + '%' : '-', d.risk?.label || '-',
                    ...resourceTypes.flatMap(r => !isLevel5 ? ['N/A', 'Auto from Lvl 5', ''] : d.status === 'completed' ? ['ready', 'Auto', ''] : [item.resources[r].status, `"${(item.resources[r].description || '').replace(/"/g, '""')}"`, item.resources[r].estimatedDate || ''])];
            });
            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `work_items_${new Date().toISOString().slice(0,10)}.csv`; link.click();
            showToast('Data di-export', 'success');
        }

        function clearData() { if (confirm('Hapus SEMUA data?')) { workItems = []; localStorage.removeItem('workItems_v11'); document.getElementById('importResult').classList.remove('show'); applyFilters(); updateStats(); showToast('Semua data dihapus', 'info'); } }
        function showToast(msg, type = 'info') { const toast = document.getElementById('toast'); toast.className = `toast ${type}`; document.getElementById('toastMessage').textContent = msg; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }
        function saveToStorage() { try { localStorage.setItem('workItems_v11', JSON.stringify(workItems)); } catch(e) {} }
        function loadFromStorage() { try { const saved = localStorage.getItem('workItems_v11'); if (saved) { workItems = JSON.parse(saved); applyFilters(); updateStats(); } } catch(e) {} }

        document.getElementById('summaryModal').onclick = e => { if (e.target === e.currentTarget) closeSummaryModal(); };
        document.onkeydown = e => { if (e.key === 'Escape') closeSummaryModal(); };
        document.addEventListener('DOMContentLoaded', () => { initResourceGrid(); initRadarChart(); loadFromStorage(); });
    </script>
</body>
</html>
